0~~~~                            ~~ Monitor: a8b0c927-f5e1-4151-b818-86c9f18995f4
   2018-05-30 16h09.26.3668626 i Topic: CK.Monitoring.DispatcherSink
   2018-05-30 16h09.26.4102838   > Initializing TextFile handler (MaxCountPerFile = 20000).
   2018-05-30 16h09.26.4227591   < 
1~~~~                            ~~ Monitor: d35751bd-c652-4259-9cf8-668414186ded
   2018-05-30 16h09.26.5649946 i Folder 'C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\TestStores' has been cleaned up.
   2018-05-30 16h09.26.7020599 i Using default connection string: Server=.;Database=master;Integrated Security=SSPI
   2018-05-30 16h09.27.7084301 i > Running DBSetup on Database:TEST_WEB_APP_AUTH, Collation:Latin1_General_100_BIN2, CompatibilityLevel:130.
   2018-05-30 16h09.27.7308785 i | > Ensuring database 'Database:TEST_WEB_APP_AUTH, Collation:Latin1_General_100_BIN2, CompatibilityLevel:130'.
   2018-05-30 16h09.27.9150354 i | <  | 1 conclusion:
                                 |    | Database already exists, collation and compatiblity level match.
   2018-05-30 16h09.27.9265143 i | > Running StObjSetup.
   2018-05-30 16h09.27.9724291 i | | No 'CKSetup/DefaultBinPaths' configuration. Using current BinFolder.
   2018-05-30 16h09.28.0707454 i | | > Running Setup on 'C:\Dev\LocalFeed\Local\CKSetupStore' for the first time.
   2018-05-30 16h09.28.0712447 i | | | No 'CKSetup/AutoRegisterLocalComponentPaths' components specified.
   2018-05-30 16h09.28.0712447 i | | < 
   2018-05-30 16h09.28.0712447 i | | Using store 'C:\Dev\LocalFeed\Local\CKSetupStore'.
   2018-05-30 16h09.28.0712447 i | | Using remote 'file:///C:/Dev/LocalFeed/Local/CKSetupStore'.
   2018-05-30 16h09.28.2978241   | | Opened store with 118 components.
   2018-05-30 16h09.28.2983226   | | Local store opened on : 'C:\Dev\LocalFeed\Local\CKSetupStore'.
   2018-05-30 16h09.28.3197822   | | > Creating client remote store on 'file:///C:/Dev/LocalFeed/Local/CKSetupStore'.
   2018-05-30 16h09.28.3666961   | | | Opened store with 118 components.
   2018-05-30 16h09.28.3666961   | | | Local store opened on : 'C:\Dev\LocalFeed\Local\CKSetupStore'.
   2018-05-30 16h09.28.3666961   | | < 
   2018-05-30 16h09.28.3686931 i | | > Running Setup.
   2018-05-30 16h09.28.3846616   | | | > Initializing SetupContext (ignoring signatures).
   2018-05-30 16h09.28.4650138 i | | | | <Root>
                                 | | | |     <CKSetup>
                                 | | | |       <BinPaths>
                                 | | | |         <BinPath>C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461</BinPath>
                                 | | | |       </BinPaths>
                                 | | | |       <Dependencies />
                                 | | | |       <EngineAssemblyQualifiedName>CK.Setup.StObjEngine, CK.StObj.Engine</EngineAssemblyQualifiedName>
                                 | | | |     </CKSetup>
                                 | | | |     <Configuration>
                                 | | | |       <AppContextAssemblyGeneratedDirectoryTarget>C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461</AppContextAssemblyGeneratedDirectoryTarget>
                                 | | | |       <GenerateSourceFiles>true</GenerateSourceFiles>
                                 | | | |       <Assemblies />
                                 | | | |       <Types />
                                 | | | |       <Aspect Type="CK.Setup.SetupableAspectConfiguration, CK.Setupable.Model" Version="1" />
                                 | | | |       <Aspect Type="CK.Setup.SqlSetupAspectConfiguration, CK.SqlServer.Setup.Model">
                                 | | | |         <Databases />
                                 | | | |         <DefaultDatabaseConnectionString>Data Source=.;Initial Catalog=TEST_WEB_APP_AUTH;Integrated Security=True</DefaultDatabaseConnectionString>
                                 | | | |         <GlobalResolution>true</GlobalResolution>
                                 | | | |       </Aspect>
                                 | | | |     </Configuration>
                                 | | | |   </Root>
   2018-05-30 16h09.28.4650138 i | | | | Configuration BasePath is empty: using current directory 'C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461'.
   2018-05-30 16h09.28.4685066 i | | | | > Reading binary folders.
   2018-05-30 16h09.28.4729972 i | | | | | > Reading files from 'C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461'.
   2018-05-30 16h09.29.4164549 i | | | | | < 
   2018-05-30 16h09.29.4169538 i | | | | <  | 1 conclusion:
                                 | | | |    | 1 folders read.
   2018-05-30 16h09.29.5338006 i | | | | Created temporary Working Directory: C:\Users\olivi\AppData\Local\Temp\CKSetup2018-05-30 16h09.29.5323034\.
   2018-05-30 16h09.29.5343022   | | | < 
   2018-05-30 16h09.29.5388101 i | | | > Resolving runtime support for 'C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461\'.
   2018-05-30 16h09.29.5412868 i | | | | > Creating runtime dependencies resolver for C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461\.
   2018-05-30 16h09.29.5467953 i | | | | | > Detecting runtimes for: CK.Setupable.Model/Net461, CK.SqlServer.Setup.Model/Net461, CK.StObj.Model/Net461
   2018-05-30 16h09.29.5662557 i | | | | | | Multiple possible runtime: Net461, Net462, Net47.
   2018-05-30 16h09.29.5696240 i | | | | | <  | 1 conclusion:
                                 | | | | |    | Lowest selected runtime: Net461.
   2018-05-30 16h09.29.5970758 i | | | | < 
   2018-05-30 16h09.29.5990723 i | | | | > Initializing root dependencies.
   2018-05-30 16h09.29.6210312   | | | | | Resolved required dependency -> CK.Setupable.Runtime/6.0.1-C0006-local to local CK.Setupable.Runtime/6.0.1-C0006-local/Net461/.
   2018-05-30 16h09.29.6250251   | | | | | Resolved required dependency -> CK.SqlServer.Setup.Runtime/6.0.1-C0006-local to local CK.SqlServer.Setup.Runtime/6.0.1-C0006-local/Net461/.
   2018-05-30 16h09.29.6250251   | | | | | Resolved required dependency -> CK.StObj.Runtime/6.0.1-C0006-local to local CK.StObj.Runtime/6.0.1-C0006-local/Net461/.
   2018-05-30 16h09.29.6250251   | | | | | Resolved required dependency -> CKSetup.Runner/6.0.1-C0008-local to local CKSetup.Runner/6.0.1-C0008-local/Net461/.
   2018-05-30 16h09.29.6275205 i | | | | < 
   2018-05-30 16h09.29.6275205 i | | | | > Resolving dependencies.
   2018-05-30 16h09.29.6280203   | | | | | Resolved required dependency -> CK.Setupable.Engine/6.0.1-C0006-local to local CK.Setupable.Engine/6.0.1-C0006-local/Net461/.
   2018-05-30 16h09.29.6285175   | | | | | Resolved required dependency -> CK.SqlServer.Setup.Engine/6.0.1-C0006-local to local CK.SqlServer.Setup.Engine/6.0.1-C0006-local/Net461/.
   2018-05-30 16h09.29.6285175   | | | | | Resolved required dependency -> CK.StObj.Engine/6.0.1-C0006-local to local CK.StObj.Engine/6.0.1-C0006-local/Net461/.
   2018-05-30 16h09.29.6285175 i | | | | < 
   2018-05-30 16h09.29.6345065 i | | | | > Selected 129 setup files.
   2018-05-30 16h09.29.6559657 i | | | | < 
   2018-05-30 16h09.29.6559657 i | | | < 
   2018-05-30 16h09.29.6559657 i | | | > Copying files to 'C:\Users\olivi\AppData\Local\Temp\CKSetup2018-05-30 16h09.29.5323034\'.
   2018-05-30 16h09.31.8092052 i | | | < 
   2018-05-30 16h09.31.8092052 i | | | > Copying 192 files from bin folders.
   2018-05-30 16h09.33.1636737 i | | | <  | 1 conclusion:
                                 | | |    | Skipped 107 file(s).
   2018-05-30 16h09.33.1636737 i | | | > Generating CKSetup.Runner.Config.xml file.
   2018-05-30 16h09.33.1990651 i | | | < 
   2018-05-30 16h09.33.2005627 i | | | > Launching CKSetup.Runner process.
   2018-05-30 16h09.33.2160359   | | | | > C:\Users\olivi\AppData\Local\Temp\CKSetup2018-05-30 16h09.29.5323034\CKSetup.Runner.exe  /silent /logPipe:2352
   2018-05-30 16h09.33.3988674 i | | | | | > Starting CKSetup.Runner - 6.0.1--ci.8.local (6.0.1-C0008-local) - SHA1: 6138daf7e47b13471540c681d64f4ce7e2f40cf6 - CommitDate: 2018-05-30 14:53:53Z
   2018-05-30 16h09.33.4562486 i | | | | | | > Applying CKSetup configuration.
   2018-05-30 16h09.33.4587440 i | | | | | | | Handling 1 BinPath(s).
   2018-05-30 16h09.33.4602416 i | | | | | | < 
   2018-05-30 16h09.33.4692228 i | | | | | | > Validating configuration.
   2018-05-30 16h09.33.4748129 i | | | | | | < 
   2018-05-30 16h09.33.4898024   | | | | | | > Creating and configuring 2 aspect(s).
   2018-05-30 16h09.33.5340728   | | | | | | | > Configuring aspect 'CK.Setup.SetupableAspect'.
   2018-05-30 16h09.33.5355686   | | | | | | | < 
   2018-05-30 16h09.33.5471251   | | | | | | | > Configuring aspect 'CK.SqlServer.Setup.SqlSetupAspect'.
   2018-05-30 16h09.33.5630967 i | | | | | | | | > Connection to Data Source=.;Initial Catalog=TEST_WEB_APP_AUTH;Integrated Security=True.
   2018-05-30 16h09.33.6380975 i | | | | | | | | | Connected to database.
   2018-05-30 16h09.33.6390957 i | | | | | | | | < 
   2018-05-30 16h09.33.6395942 i | | | | | | | | Registering SqlVersionedItemReader on the default database as the version reader.
   2018-05-30 16h09.33.6415903 i | | | | | | | | Registering SqlVersionedItemWriter on the default database as the version writer.
   2018-05-30 16h09.33.6420896 i | | | | | | | | Registering SqlSetupSessionMemoryProvider on the default database as the memory provider.
   2018-05-30 16h09.33.7243464   | | | | | | | < 
   2018-05-30 16h09.33.7248453 i | | | | | | | > Executing initial 1 deferred actions.
   2018-05-30 16h09.33.7258435 i | | | | | | | <  | 1 conclusion:
                                 | | | | | | |    | Executed 1 actions.
   2018-05-30 16h09.33.7303207 i | | | | | | | No explicit ISimpleObjectActivator has been registered. Using a default SimpleObjectActivator.
   2018-05-30 16h09.33.7303207   | | | | | | < 
   2018-05-30 16h09.33.7328157 i | | | | | | > Building StObj objects.
   2018-05-30 16h09.33.7775440 i | | | | | | | > Registering StObj types.
   2018-05-30 16h09.33.7785427   | | | | | | | | > Registering 16 assemblies.
   2018-05-30 16h09.33.7785427   | | | | | | | | | > Registering assembly 'CK.Setupable.Model'.
   2018-05-30 16h09.33.7815370   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 16 types(s) registered.
   2018-05-30 16h09.33.7820176   | | | | | | | | | > Registering assembly 'CK.SqlServer.Setup.Model'.
   2018-05-30 16h09.33.8059873   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 43 types(s) registered.
   2018-05-30 16h09.33.8059873   | | | | | | | | | > Registering assembly 'CK.StObj.Model'.
   2018-05-30 16h09.33.8079838   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 22 types(s) registered.
   2018-05-30 16h09.33.8079838   | | | | | | | | | > Registering assembly 'CK.DB.Actor'.
   2018-05-30 16h09.33.8169663   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 6 types(s) registered.
   2018-05-30 16h09.33.8169663   | | | | | | | | | > Registering assembly 'CK.DB.AspNet.Auth'.
   2018-05-30 16h09.33.8338849   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 8 types(s) registered.
   2018-05-30 16h09.33.8343776   | | | | | | | | | > Registering assembly 'CK.DB.AspNet'.
   2018-05-30 16h09.33.8383581   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 3 types(s) registered.
   2018-05-30 16h09.33.8388570   | | | | | | | | | > Registering assembly 'CK.DB.Auth'.
   2018-05-30 16h09.33.8403546   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 13 types(s) registered.
   2018-05-30 16h09.33.8403546   | | | | | | | | | > Registering assembly 'CK.DB.Tests.NUnit'.
   2018-05-30 16h09.33.8438902   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 8 types(s) registered.
   2018-05-30 16h09.33.8438902   | | | | | | | | | > Registering assembly 'CK.DB.User.UserGoogle'.
   2018-05-30 16h09.33.8471179   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 7 types(s) registered.
   2018-05-30 16h09.33.8471179   | | | | | | | | | > Registering assembly 'CK.DB.User.UserOidc'.
   2018-05-30 16h09.33.8496125   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 8 types(s) registered.
   2018-05-30 16h09.33.8496125   | | | | | | | | | > Registering assembly 'CK.DB.User.UserPassword'.
   2018-05-30 16h09.33.8526233   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 5 types(s) registered.
   2018-05-30 16h09.33.8526233   | | | | | | | | | > Registering assembly 'CK.Testing.DBSetup'.
   2018-05-30 16h09.33.8751057   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 2 types(s) registered.
   2018-05-30 16h09.33.8751057   | | | | | | | | | > Registering assembly 'CK.Testing.SetupableSetup'.
   2018-05-30 16h09.33.8761039   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 2 types(s) registered.
   2018-05-30 16h09.33.8761039   | | | | | | | | | > Registering assembly 'CK.Testing.StObjMap'.
   2018-05-30 16h09.33.8766046   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 2 types(s) registered.
   2018-05-30 16h09.33.8766046   | | | | | | | | | > Registering assembly 'CK.Testing.StObjSetup'.
   2018-05-30 16h09.33.8776212   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 5 types(s) registered.
   2018-05-30 16h09.33.8776212   | | | | | | | | | > Registering assembly 'WebApp.Tests'.
   2018-05-30 16h09.33.8950685   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 33 types(s) registered.
   2018-05-30 16h09.33.8950685   | | | | | | | | < 
   2018-05-30 16h09.33.8980629   | | | | | | | | > Explicitely registering 0 type(s).
   2018-05-30 16h09.33.8980629   | | | | | | | | < 
   2018-05-30 16h09.33.8995605 i | | | | | | | < 
   2018-05-30 16h09.33.8995605 i | | | | | | | > Resolving StObj dependency graph.
   2018-05-30 16h09.33.9035530 i | | | | | | | | > Collecting all StObj information.
   2018-05-30 16h09.33.9035530 i | | | | | | | | | > Collecting Ambient Contracts, Type structure and Poco.
   2018-05-30 16h09.33.9065474 i | | | | | | | | | | > Creating Poco Types and PocoFactory.
   2018-05-30 16h09.33.9576132 i | | | | | | | | | | < 
   2018-05-30 16h09.34.0470363   | | | | | | | | | | > Ambient Contract discovering: 1 context(s).
   2018-05-30 16h09.34.0510288   | | | | | | | | | | | > Ambient Contract for context '': 25 mappings for 15 concrete paths.
   2018-05-30 16h09.34.0510288   | | | | | | | | | | | < 
   2018-05-30 16h09.34.0510288   | | | | | | | | | | < 
   2018-05-30 16h09.34.0510288 i | | | | | | | | | < 
   2018-05-30 16h09.34.0580193 i | | | | | | | | | > Creating Structure Objects.
   2018-05-30 16h09.34.0585142 i | | | | | | | | | | > Working on Context [].
   2018-05-30 16h09.34.0959450 i | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | |    | 15 items created for 15 types.
   2018-05-30 16h09.34.0959450 i | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | 15 items created.
   2018-05-30 16h09.34.0959450 i | | | | | | | | | > Handling dependencies.
   2018-05-30 16h09.34.0974430 i | | | | | | | | | | > Working on Context [].
   2018-05-30 16h09.34.1014383   | | | | | | | | | | | > Preparing '[]CK.SqlServer.Setup.SqlDefaultDatabase'.
   2018-05-30 16h09.34.1144129   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Group
   2018-05-30 16h09.34.1144129   | | | | | | | | | | | > Preparing '[]CK.DB.Actor.ActorProfileTable'.
   2018-05-30 16h09.34.1144129   | | | | | | | | | | | | > Preparing '[]CK.DB.Actor.Package'.
   2018-05-30 16h09.34.1154116   | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1248908   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1253910   | | | | | | | | | | | > Preparing '[]CK.DB.Actor.ActorTable'.
   2018-05-30 16h09.34.1253910   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1253910   | | | | | | | | | | | > Preparing '[]CK.DB.Actor.GroupTable'.
   2018-05-30 16h09.34.1253910   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1258904   | | | | | | | | | | | > Preparing '[]CK.DB.Actor.UserTable'.
   2018-05-30 16h09.34.1258904   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1258904   | | | | | | | | | | | > Preparing '[]CK.DB.Auth.AuthProviderTable'.
   2018-05-30 16h09.34.1258904   | | | | | | | | | | | | > Preparing '[]CK.DB.Auth.Package'.
   2018-05-30 16h09.34.1258904   | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1258904   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1263884   | | | | | | | | | | | > Preparing '[]CK.DB.User.UserGoogle.Package'.
   2018-05-30 16h09.34.1263884   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1263884   | | | | | | | | | | | > Preparing '[]CK.DB.User.UserGoogle.UserGoogleTable'.
   2018-05-30 16h09.34.1268891   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1268891   | | | | | | | | | | | > Preparing '[]CK.DB.User.UserOidc.Package'.
   2018-05-30 16h09.34.1268891   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1268891   | | | | | | | | | | | > Preparing '[]CK.DB.User.UserOidc.UserOidcTable'.
   2018-05-30 16h09.34.1268891   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1273862   | | | | | | | | | | | > Preparing '[]CK.DB.User.UserPassword.Package'.
   2018-05-30 16h09.34.1273862   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1273862   | | | | | | | | | | | > Preparing '[]CK.DB.User.UserPassword.UserPasswordTable'.
   2018-05-30 16h09.34.1273862   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Container
   2018-05-30 16h09.34.1273862   | | | | | | | | | | | > Preparing '[]CK._g.poco.Factory'.
   2018-05-30 16h09.34.1278856 W | | | | | | | | | | | | Since ItemKind is not specified on this base class ('[]CK._g.poco.Factory'), it defaults to SimpleItem. It should be explicitely set to either SimpleItem, Group or Container.
   2018-05-30 16h09.34.1298825   | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | |    | ItemKind is Item
   2018-05-30 16h09.34.1303819 i | | | | | | | | | | < 
   2018-05-30 16h09.34.1338773 i | | | | | | | | | | > Working on Context [].
   2018-05-30 16h09.34.1468520 i | | | | | | | | | | < 
   2018-05-30 16h09.34.1877760 i | | | | | | | | | < 
   2018-05-30 16h09.34.1882753 i | | | | | | | | | > Initializing object graph.
   2018-05-30 16h09.34.1927664   | | | | | | | | | | > Constructing '[]CK._g.poco.Factory'.
   2018-05-30 16h09.34.1942635   | | | | | | | | | | < 
   2018-05-30 16h09.34.1947624   | | | | | | | | | | > Constructing '[]CK.SqlServer.Setup.SqlDefaultDatabase'.
   2018-05-30 16h09.34.1967580   | | | | | | | | | | < 
   2018-05-30 16h09.34.1972569   | | | | | | | | | | > Constructing '[]CK.DB.Actor.Package'.
   2018-05-30 16h09.34.2002513   | | | | | | | | | | < 
   2018-05-30 16h09.34.2002513   | | | | | | | | | | > Constructing '[]CK.DB.Actor.ActorTable'.
   2018-05-30 16h09.34.2007506   | | | | | | | | | | < 
   2018-05-30 16h09.34.2032456   | | | | | | | | | | > Constructing '[]CK.DB.Actor.GroupTable'.
   2018-05-30 16h09.34.2037445   | | | | | | | | | | < 
   2018-05-30 16h09.34.2037445   | | | | | | | | | | > Constructing '[]CK.DB.Actor.UserTable'.
   2018-05-30 16h09.34.2037445   | | | | | | | | | | < 
   2018-05-30 16h09.34.2037445   | | | | | | | | | | > Constructing '[]CK.DB.Actor.ActorProfileTable'.
   2018-05-30 16h09.34.2042434   | | | | | | | | | | < 
   2018-05-30 16h09.34.2042434   | | | | | | | | | | > Constructing '[]CK.DB.Auth.Package'.
   2018-05-30 16h09.34.2042434   | | | | | | | | | | < 
   2018-05-30 16h09.34.2042434   | | | | | | | | | | > Constructing '[]CK.DB.Auth.AuthProviderTable'.
   2018-05-30 16h09.34.2042434   | | | | | | | | | | < 
   2018-05-30 16h09.34.2042434   | | | | | | | | | | > Constructing '[]CK.DB.User.UserGoogle.Package'.
   2018-05-30 16h09.34.2047432   | | | | | | | | | | < 
   2018-05-30 16h09.34.2047432   | | | | | | | | | | > Constructing '[]CK.DB.User.UserOidc.Package'.
   2018-05-30 16h09.34.2047432   | | | | | | | | | | < 
   2018-05-30 16h09.34.2047432   | | | | | | | | | | > Constructing '[]CK.DB.User.UserPassword.Package'.
   2018-05-30 16h09.34.2047432   | | | | | | | | | | < 
   2018-05-30 16h09.34.2047432   | | | | | | | | | | > Constructing '[]CK.DB.User.UserGoogle.UserGoogleTable'.
   2018-05-30 16h09.34.2052416   | | | | | | | | | | < 
   2018-05-30 16h09.34.2052416   | | | | | | | | | | > Constructing '[]CK.DB.User.UserOidc.UserOidcTable'.
   2018-05-30 16h09.34.2052416   | | | | | | | | | | < 
   2018-05-30 16h09.34.2052416   | | | | | | | | | | > Constructing '[]CK.DB.User.UserPassword.UserPasswordTable'.
   2018-05-30 16h09.34.2057405   | | | | | | | | | | < 
   2018-05-30 16h09.34.2057405 i | | | | | | | | | | > Setting Ambient Contracts.
   2018-05-30 16h09.34.2067392 i | | | | | | | | | | | > Working on Context [].
   2018-05-30 16h09.34.2077371 i | | | | | | | | | | | < 
   2018-05-30 16h09.34.2077371 i | | | | | | | | | | < 
   2018-05-30 16h09.34.2077371 i | | | | | | | | | < 
   2018-05-30 16h09.34.2082360 i | | | | | | | | < 
   2018-05-30 16h09.34.2082360 i | | | | | | | < 
   2018-05-30 16h09.34.2082360 i | | | | | | < 
   2018-05-30 16h09.34.2102343 i | | | | | | > Running Aspects.
   2018-05-30 16h09.34.2102343 i | | | | | | | > Aspect: CK.Setup.SetupableAspect.
   2018-05-30 16h09.34.2137275 i | | | | | | | | > Creating Setup Items from Structured Objects.
   2018-05-30 16h09.34.2157240 i | | | | | | | | | > Building setupable items from 15 Structure Objects (calling IStObjSetupConfigurator.ConfigureDependentItem and IStObjSetupItemFactory.CreateDependentItem for each of them).
   2018-05-30 16h09.34.2456694 i | | | | | | | | | | SqlPackage 'CK.DB.Actor.Package' uses its own full name as its SetupName.
   2018-05-30 16h09.34.2666297 i | | | | | | | | | | SqlTable 'CK.DB.Actor.ActorTable' uses 'CK.ActorTable' as its SetupName.
   2018-05-30 16h09.34.2676257 i | | | | | | | | | | SqlTable 'CK.DB.Actor.GroupTable' uses 'CK.GroupTable' as its SetupName.
   2018-05-30 16h09.34.2681250 i | | | | | | | | | | SqlTable 'CK.DB.Actor.UserTable' uses 'CK.UserTable' as its SetupName.
   2018-05-30 16h09.34.2686239 i | | | | | | | | | | SqlTable 'CK.DB.Actor.ActorProfileTable' uses 'CK.ActorProfileTable' as its SetupName.
   2018-05-30 16h09.34.2686239 i | | | | | | | | | | SqlPackage 'CK.DB.Auth.Package' uses its own full name as its SetupName.
   2018-05-30 16h09.34.2691233 i | | | | | | | | | | SqlTable 'CK.DB.Auth.AuthProviderTable' uses 'CK.AuthProviderTable' as its SetupName.
   2018-05-30 16h09.34.2691233 i | | | | | | | | | | SqlPackage 'CK.DB.User.UserGoogle.Package' uses its own full name as its SetupName.
   2018-05-30 16h09.34.2696222 i | | | | | | | | | | SqlPackage 'CK.DB.User.UserOidc.Package' uses its own full name as its SetupName.
   2018-05-30 16h09.34.2701215 i | | | | | | | | | | SqlPackage 'CK.DB.User.UserPassword.Package' uses its own full name as its SetupName.
   2018-05-30 16h09.34.2701215 i | | | | | | | | | | SqlTable 'CK.DB.User.UserGoogle.UserGoogleTable' uses 'CK.UserGoogleTable' as its SetupName.
   2018-05-30 16h09.34.2706204 i | | | | | | | | | | SqlTable 'CK.DB.User.UserOidc.UserOidcTable' uses 'CK.UserOidcTable' as its SetupName.
   2018-05-30 16h09.34.2706204 i | | | | | | | | | | SqlTable 'CK.DB.User.UserPassword.UserPasswordTable' uses 'CK.UserPasswordTable' as its SetupName.
   2018-05-30 16h09.34.2711193 i | | | | | | | | | < 
   2018-05-30 16h09.34.2726165 i | | | | | | | | | > Binding dependencies between Setupable items.
   2018-05-30 16h09.34.2751115 i | | | | | | | | | < 
   2018-05-30 16h09.34.2771080 i | | | | | | | | | > Dynamic initialization of Setup items.
   2018-05-30 16h09.34.3010634 i | | | | | | | | | | > Executing 45 deferred actions.
   2018-05-30 16h09.34.3015655 i | | | | | | | | | | | > Starting intialization round n°0.
   2018-05-30 16h09.34.3050569 i | | | | | | | | | | | | > Handling: '[]db^CK.sActorCreate' in SqlObjectItem attribute of '[]db^CK.ActorTable'
   2018-05-30 16h09.34.3075523   | | | | | | | | | | | | | > Loading '[]db^CK.sActorCreate' of '[]db^CK.ActorTable'.
   2018-05-30 16h09.34.4698605   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sActorCreate.sql'.
   2018-05-30 16h09.34.4698605 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.4698605 i | | | | | | | | | | | | > Handling: '[]db^CK.vGroup' in SqlObjectItem attribute of '[]db^CK.GroupTable'
   2018-05-30 16h09.34.4698605   | | | | | | | | | | | | | > Loading '[]db^CK.vGroup' of '[]db^CK.GroupTable'.
   2018-05-30 16h09.34.5097867   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded View from file 'vGroup.sql'.
   2018-05-30 16h09.34.5097867 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5107849 i | | | | | | | | | | | | > Handling: 'sGroupCreate' in 'CreateGroupAsync' SqlProcedure attribute of '[]db^CK.GroupTable'
   2018-05-30 16h09.34.5112838   | | | | | | | | | | | | | > Loading '[]db^CK.sGroupCreate' of '[]db^CK.GroupTable'.
   2018-05-30 16h09.34.5252576   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sGroupCreate.sql'.
   2018-05-30 16h09.34.5252576 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5257565 i | | | | | | | | | | | | > Handling: 'sGroupDestroy' in 'DestroyGroupAsync' SqlProcedure attribute of '[]db^CK.GroupTable'
   2018-05-30 16h09.34.5257565   | | | | | | | | | | | | | > Loading '[]db^CK.sGroupDestroy' of '[]db^CK.GroupTable'.
   2018-05-30 16h09.34.5317608   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sGroupDestroy.sql'.
   2018-05-30 16h09.34.5317608 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5317608 i | | | | | | | | | | | | > Handling: 'sGroupUserAdd' in 'AddUserAsync' SqlProcedure attribute of '[]db^CK.GroupTable'
   2018-05-30 16h09.34.5317608   | | | | | | | | | | | | | > Loading '[]db^CK.sGroupUserAdd' of '[]db^CK.GroupTable'.
   2018-05-30 16h09.34.5342566   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sGroupUserAdd.sql'.
   2018-05-30 16h09.34.5342566 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5342566 i | | | | | | | | | | | | > Handling: 'sGroupUserRemove' in 'RemoveUserAsync' SqlProcedure attribute of '[]db^CK.GroupTable'
   2018-05-30 16h09.34.5347399   | | | | | | | | | | | | | > Loading '[]db^CK.sGroupUserRemove' of '[]db^CK.GroupTable'.
   2018-05-30 16h09.34.5352540   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sGroupUserRemove.sql'.
   2018-05-30 16h09.34.5352540 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5352540 i | | | | | | | | | | | | > Handling: 'sGroupRemoveAllUsers' in 'RemoveAllUsersAsync' SqlProcedure attribute of '[]db^CK.GroupTable'
   2018-05-30 16h09.34.5352540   | | | | | | | | | | | | | > Loading '[]db^CK.sGroupRemoveAllUsers' of '[]db^CK.GroupTable'.
   2018-05-30 16h09.34.5442222   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sGroupRemoveAllUsers.sql'.
   2018-05-30 16h09.34.5442222 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5442222 i | | | | | | | | | | | | > Handling: '[]db^CK.vUser' in SqlObjectItem attribute of '[]db^CK.UserTable'
   2018-05-30 16h09.34.5442222   | | | | | | | | | | | | | > Loading '[]db^CK.vUser' of '[]db^CK.UserTable'.
   2018-05-30 16h09.34.5447220   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded View from file 'vUser.sql'.
   2018-05-30 16h09.34.5447220 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5447220 i | | | | | | | | | | | | > Handling: 'sUserCreate' in 'CreateUserAsync' SqlProcedure attribute of '[]db^CK.UserTable'
   2018-05-30 16h09.34.5447220   | | | | | | | | | | | | | > Loading '[]db^CK.sUserCreate' of '[]db^CK.UserTable'.
   2018-05-30 16h09.34.5462201   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserCreate.sql'.
   2018-05-30 16h09.34.5462201 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5462201 i | | | | | | | | | | | | > Handling: 'sUserUserNameSet' in 'UserNameSetAsync' SqlProcedure attribute of '[]db^CK.UserTable'
   2018-05-30 16h09.34.5462201   | | | | | | | | | | | | | > Loading '[]db^CK.sUserUserNameSet' of '[]db^CK.UserTable'.
   2018-05-30 16h09.34.5492131   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserUserNameSet.sql'.
   2018-05-30 16h09.34.5492131 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5492131 i | | | | | | | | | | | | > Handling: 'sUserDestroy' in 'DestroyUserAsync' SqlProcedure attribute of '[]db^CK.UserTable'
   2018-05-30 16h09.34.5492131   | | | | | | | | | | | | | > Loading '[]db^CK.sUserDestroy' of '[]db^CK.UserTable'.
   2018-05-30 16h09.34.5502118   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserDestroy.sql'.
   2018-05-30 16h09.34.5502118 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5502118 i | | | | | | | | | | | | > Handling: 'sUserRemoveFromAllGroups' in 'RemoveFromAllGroupsAsync' SqlProcedure attribute of '[]db^CK.UserTable'
   2018-05-30 16h09.34.5502118   | | | | | | | | | | | | | > Loading '[]db^CK.sUserRemoveFromAllGroups' of '[]db^CK.UserTable'.
   2018-05-30 16h09.34.5507107   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserRemoveFromAllGroups.sql'.
   2018-05-30 16h09.34.5507107 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5507107 i | | | | | | | | | | | | > Handling: '[]db^CK.vUserAuthProvider' in SqlObjectItem attribute of '[]db^CK.DB.Auth.Package'
   2018-05-30 16h09.34.5507107   | | | | | | | | | | | | | > Loading '[]db^CK.vUserAuthProvider' of '[]db^CK.DB.Auth.Package'.
   2018-05-30 16h09.34.5512096   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded View from file 'vUserAuthProvider.sql'.
   2018-05-30 16h09.34.5512096 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5517085 i | | | | | | | | | | | | > Handling: 'sAuthUserInfoRead' in 'CmdReadUserAuthInfo' SqlProcedureNoExecute attribute of '[]db^CK.DB.Auth.Package'
   2018-05-30 16h09.34.5517085   | | | | | | | | | | | | | > Loading '[]db^CK.sAuthUserInfoRead' of '[]db^CK.DB.Auth.Package'.
   2018-05-30 16h09.34.5586954   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sAuthUserInfoRead.sql'.
   2018-05-30 16h09.34.5586954 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5591947 i | | | | | | | | | | | | > Handling: 'sAuthUserOnLogin' in 'OnUserLoginAsync' SqlProcedure attribute of '[]db^CK.DB.Auth.Package'
   2018-05-30 16h09.34.5591947   | | | | | | | | | | | | | > Loading '[]db^CK.sAuthUserOnLogin' of '[]db^CK.DB.Auth.Package'.
   2018-05-30 16h09.34.5646845   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sAuthUserOnLogin.sql'.
   2018-05-30 16h09.34.5646845 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5646845 i | | | | | | | | | | | | > Handling: 'sAuthProviderRegister' in 'RegisterProviderAsync' SqlProcedure attribute of '[]db^CK.AuthProviderTable'
   2018-05-30 16h09.34.5646845   | | | | | | | | | | | | | > Loading '[]db^CK.sAuthProviderRegister' of '[]db^CK.AuthProviderTable'.
   2018-05-30 16h09.34.5656827   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sAuthProviderRegister.sql'.
   2018-05-30 16h09.34.5656827 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5656827 i | | | | | | | | | | | | > Handling: '[]db^CK.DB.User.UserGoogle.Package([]db^CK.vUserAuthProvider)' in SqlObjectItem attribute of '[]db^CK.DB.User.UserGoogle.Package'
   2018-05-30 16h09.34.5656827   | | | | | | | | | | | | | > Loading '[]db^CK.DB.User.UserGoogle.Package([]db^CK.vUserAuthProvider)' of '[]db^CK.DB.User.UserGoogle.Package'.
   2018-05-30 16h09.34.5881557   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Transformer from file 'vUserAuthProvider.tql'.
   2018-05-30 16h09.34.5881557 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5881557 i | | | | | | | | | | | | > Handling: '[]db^CK.DB.User.UserOidc.Package([]db^CK.vUserAuthProvider)' in SqlObjectItem attribute of '[]db^CK.DB.User.UserOidc.Package'
   2018-05-30 16h09.34.5881557   | | | | | | | | | | | | | > Loading '[]db^CK.DB.User.UserOidc.Package([]db^CK.vUserAuthProvider)' of '[]db^CK.DB.User.UserOidc.Package'.
   2018-05-30 16h09.34.5886551   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Transformer from file 'vUserAuthProvider.tql'.
   2018-05-30 16h09.34.5886551 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5886551 i | | | | | | | | | | | | > Handling: '[]db^CK.DB.User.UserPassword.Package([]db^CK.vUserAuthProvider)' in SqlObjectItem attribute of '[]db^CK.DB.User.UserPassword.Package'
   2018-05-30 16h09.34.5886551   | | | | | | | | | | | | | > Loading '[]db^CK.DB.User.UserPassword.Package([]db^CK.vUserAuthProvider)' of '[]db^CK.DB.User.UserPassword.Package'.
   2018-05-30 16h09.34.5891535   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Transformer from file 'vUserAuthProvider.tql'.
   2018-05-30 16h09.34.5891535 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5891535 i | | | | | | | | | | | | > Handling: '[]db^CK.UserGoogleTable([]db^CK.sUserDestroy)' in SqlObjectItem attribute of '[]db^CK.UserGoogleTable'
   2018-05-30 16h09.34.5891535   | | | | | | | | | | | | | > Loading '[]db^CK.UserGoogleTable([]db^CK.sUserDestroy)' of '[]db^CK.UserGoogleTable'.
   2018-05-30 16h09.34.5901518   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Transformer from file 'sUserDestroy.tql'.
   2018-05-30 16h09.34.5901518 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5901518 i | | | | | | | | | | | | > Handling: 'sUserGoogleDestroy' in 'DestroyGoogleUserAsync' SqlProcedure attribute of '[]db^CK.UserGoogleTable'
   2018-05-30 16h09.34.5901518   | | | | | | | | | | | | | > Loading '[]db^CK.sUserGoogleDestroy' of '[]db^CK.UserGoogleTable'.
   2018-05-30 16h09.34.5906360   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserGoogleDestroy.sql'.
   2018-05-30 16h09.34.5906360 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5906360 i | | | | | | | | | | | | > Handling: 'sUserGoogleUCL' in 'GoogleUserUCLAsync' SqlProcedure attribute of '[]db^CK.UserGoogleTable'
   2018-05-30 16h09.34.5906360   | | | | | | | | | | | | | > Loading '[]db^CK.sUserGoogleUCL' of '[]db^CK.UserGoogleTable'.
   2018-05-30 16h09.34.5941444   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserGoogleUCL.sql'.
   2018-05-30 16h09.34.5941444 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5941444 i | | | | | | | | | | | | > Handling: '[]db^CK.UserOidcTable([]db^CK.sUserDestroy)' in SqlObjectItem attribute of '[]db^CK.UserOidcTable'
   2018-05-30 16h09.34.5941444   | | | | | | | | | | | | | > Loading '[]db^CK.UserOidcTable([]db^CK.sUserDestroy)' of '[]db^CK.UserOidcTable'.
   2018-05-30 16h09.34.5946308   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Transformer from file 'sUserDestroy.tql'.
   2018-05-30 16h09.34.5946308 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5946308 i | | | | | | | | | | | | > Handling: 'sUserOidcDestroy' in 'DestroyOidcUserAsync' SqlProcedure attribute of '[]db^CK.UserOidcTable'
   2018-05-30 16h09.34.5946308   | | | | | | | | | | | | | > Loading '[]db^CK.sUserOidcDestroy' of '[]db^CK.UserOidcTable'.
   2018-05-30 16h09.34.5951431   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserOidcDestroy.sql'.
   2018-05-30 16h09.34.5951431 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5951431 i | | | | | | | | | | | | > Handling: 'sUserOidcUCL' in 'UserOidcULC' SqlProcedure attribute of '[]db^CK.UserOidcTable'
   2018-05-30 16h09.34.5951431   | | | | | | | | | | | | | > Loading '[]db^CK.sUserOidcUCL' of '[]db^CK.UserOidcTable'.
   2018-05-30 16h09.34.5981369   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserOidcUCL.sql'.
   2018-05-30 16h09.34.5981369 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5981369 i | | | | | | | | | | | | > Handling: '[]db^CK.UserPasswordTable([]db^CK.sUserDestroy)' in SqlObjectItem attribute of '[]db^CK.UserPasswordTable'
   2018-05-30 16h09.34.5981369   | | | | | | | | | | | | | > Loading '[]db^CK.UserPasswordTable([]db^CK.sUserDestroy)' of '[]db^CK.UserPasswordTable'.
   2018-05-30 16h09.34.5981369   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Transformer from file 'sUserDestroy.tql'.
   2018-05-30 16h09.34.5981369 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5981369 i | | | | | | | | | | | | > Handling: 'sUserPasswordDestroy' in 'DestroyPasswordUserAsync' SqlProcedure attribute of '[]db^CK.UserPasswordTable'
   2018-05-30 16h09.34.5981369   | | | | | | | | | | | | | > Loading '[]db^CK.sUserPasswordDestroy' of '[]db^CK.UserPasswordTable'.
   2018-05-30 16h09.34.5986233   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserPasswordDestroy.sql'.
   2018-05-30 16h09.34.5986233 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.5986233 i | | | | | | | | | | | | > Handling: 'sUserPasswordUCL' in 'PasswordUserUCLAsync' SqlProcedure attribute of '[]db^CK.UserPasswordTable'
   2018-05-30 16h09.34.5986233   | | | | | | | | | | | | | > Loading '[]db^CK.sUserPasswordUCL' of '[]db^CK.UserPasswordTable'.
   2018-05-30 16h09.34.6041260   | | | | | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | | | | | |    | Loaded Procedure from file 'sUserPasswordUCL.sql'.
   2018-05-30 16h09.34.6041260 i | | | | | | | | | | | | < 
   2018-05-30 16h09.34.6041260 i | | | | | | | | | | | < 
   2018-05-30 16h09.34.6041260 i | | | | | | | | | | < 
   2018-05-30 16h09.34.6041260 i | | | | | | | | | < 
   2018-05-30 16h09.34.6061886 i | | | | | | | | < 
   2018-05-30 16h09.34.6096827   | | | | | | | | > Installing CKCore kernel.
   2018-05-30 16h09.34.6141746   | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | |    | Already installed in version 15.
   2018-05-30 16h09.34.6260368 i | | | | | | | | > Reading original versions.
   2018-05-30 16h09.34.6275304   | | | | | | | | | > Installing SqlVersionedItemRepository store.
   2018-05-30 16h09.34.6320076   | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | Already installed in version 1.
   2018-05-30 16h09.34.6345034 i | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | |    | Got 26 versions.
   2018-05-30 16h09.34.6370127 i | | | | | | | | > Setupable Core Engine initialization.
   2018-05-30 16h09.34.6370127 i | | | | | | | | | Starting a new setup.
   2018-05-30 16h09.34.6394960 i | | | | | | | | < 
   2018-05-30 16h09.34.6394960 i | | | | | | | | > Register step.
   2018-05-30 16h09.34.6769232 i | | | | | | | | | > Instanciating drivers for 88 items.
   2018-05-30 16h09.34.6939449 i | | | | | | | | | < 
   2018-05-30 16h09.34.6939449 i | | | | | | | | | > Calling PreInit on 88 drivers.
   2018-05-30 16h09.34.7144067 i | | | | | | | | | | 0 sql scripts in resource found for 'CK.ActorTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7448648 i | | | | | | | | | | 1 sql scripts in resource found for 'Model.CK.ActorTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7493568 i | | | | | | | | | | 0 sql scripts in resource found for 'CK.GroupTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7493568 i | | | | | | | | | | 2 sql scripts in resource found for 'Model.CK.GroupTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7498432 i | | | | | | | | | | 0 sql scripts in resource found for 'CK.UserTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7498432 i | | | | | | | | | | 5 sql scripts in resource found for 'Model.CK.UserTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7498432 i | | | | | | | | | | 0 sql scripts in resource found for 'CK.ActorProfileTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7503550 i | | | | | | | | | | 1 sql scripts in resource found for 'Model.CK.ActorProfileTable' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7503550 i | | | | | | | | | | 0 sql scripts in resource found for 'CK.DB.Actor.Package' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7503550 i | | | | | | | | | | 0 sql scripts in resource found for 'Model.CK.DB.Actor.Package' in 'CK.DB.Actor:CK.DB.Actor.Res.*.
   2018-05-30 16h09.34.7508405 i | | | | | | | | | | 0 sql scripts in resource found for 'CK.AuthProviderTable' in 'CK.DB.Auth:CK.DB.Auth.Res.*.
   2018-05-30 16h09.34.7508405 i | | | | | | | | | | 3 sql scripts in resource found for 'Model.CK.AuthProviderTable' in 'CK.DB.Auth:CK.DB.Auth.Res.*.
   2018-05-30 16h09.34.7508405 i | | | | | | | | | | 0 sql scripts in resource found for 'CK.DB.Auth.Package' in 'CK.DB.Auth:CK.DB.Auth.Res.*.
   2018-05-30 16h09.34.7508405 i | | | | | | | | | | 0 sql scripts in resource found for 'Model.CK.DB.Auth.Package' in 'CK.DB.Auth:CK.DB.Auth.Res.*.
   2018-05-30 16h09.34.7513399 i | | | | | | | | | | 1 sql scripts in resource found for 'CK.UserGoogleTable' in 'CK.DB.User.UserGoogle:CK.DB.User.UserGoogle.Res.*.
   2018-05-30 16h09.34.7513399 i | | | | | | | | | | 4 sql scripts in resource found for 'Model.CK.UserGoogleTable' in 'CK.DB.User.UserGoogle:CK.DB.User.UserGoogle.Res.*.
   2018-05-30 16h09.34.7513399 i | | | | | | | | | | 1 sql scripts in resource found for 'CK.UserOidcTable' in 'CK.DB.User.UserOidc:CK.DB.User.UserOidc.Res.*.
   2018-05-30 16h09.34.7518526 i | | | | | | | | | | 1 sql scripts in resource found for 'Model.CK.UserOidcTable' in 'CK.DB.User.UserOidc:CK.DB.User.UserOidc.Res.*.
   2018-05-30 16h09.34.7518526 i | | | | | | | | | | 1 sql scripts in resource found for 'CK.UserPasswordTable' in 'CK.DB.User.UserPassword:CK.DB.User.UserPassword.Res.*.
   2018-05-30 16h09.34.7518526 i | | | | | | | | | | 2 sql scripts in resource found for 'Model.CK.UserPasswordTable' in 'CK.DB.User.UserPassword:CK.DB.User.UserPassword.Res.*.
   2018-05-30 16h09.34.7523381 i | | | | | | | | | | 1 sql scripts in resource found for 'CK.DB.User.UserGoogle.Package' in 'CK.DB.User.UserGoogle:CK.DB.User.UserGoogle.Res.*.
   2018-05-30 16h09.34.7523381 i | | | | | | | | | | 0 sql scripts in resource found for 'Model.CK.DB.User.UserGoogle.Package' in 'CK.DB.User.UserGoogle:CK.DB.User.UserGoogle.Res.*.
   2018-05-30 16h09.34.7523381 i | | | | | | | | | | 1 sql scripts in resource found for 'CK.DB.User.UserOidc.Package' in 'CK.DB.User.UserOidc:CK.DB.User.UserOidc.Res.*.
   2018-05-30 16h09.34.7528348 i | | | | | | | | | | 0 sql scripts in resource found for 'Model.CK.DB.User.UserOidc.Package' in 'CK.DB.User.UserOidc:CK.DB.User.UserOidc.Res.*.
   2018-05-30 16h09.34.7528348 i | | | | | | | | | | 2 sql scripts in resource found for 'CK.DB.User.UserPassword.Package' in 'CK.DB.User.UserPassword:CK.DB.User.UserPassword.Res.*.
   2018-05-30 16h09.34.7528348 i | | | | | | | | | | 0 sql scripts in resource found for 'Model.CK.DB.User.UserPassword.Package' in 'CK.DB.User.UserPassword:CK.DB.User.UserPassword.Res.*.
   2018-05-30 16h09.34.7533364 i | | | | | | | | | < 
   2018-05-30 16h09.34.7533364 i | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | |    | 88 Setup items registered.
   2018-05-30 16h09.34.7533364 i | | | | | | | | > Init step.
   2018-05-30 16h09.34.7548469   | | | | | | | | | > Raising Init setup event.
   2018-05-30 16h09.34.7548469   | | | | | | | | | < 
   2018-05-30 16h09.34.7548469 i | | | | | | | | | > Initializing []CK._g.poco.Factory
   2018-05-30 16h09.34.7563437 i | | | | | | | | | < 
   2018-05-30 16h09.34.7563437 i | | | | | | | | | > Initializing []db^SqlDatabase.Connection
   2018-05-30 16h09.34.7606075   | | | | | | | | | | if not exists(select 1 from sys.schemas where name = 'CK') begin exec( 'create schema [CK]' ); end
   2018-05-30 16h09.34.7611073   | | | | | | | | | | GO
   2018-05-30 16h09.34.7641164   | | | | | | | | | | -- Ensure that snapshot_isolation and read_committed_snapshot are on for this db.
                                 | | | | | | | | | |   declare @dbName sysname = DB_NAME();
                                 | | | | | | | | | |   declare @dbNameQ sysname = QUOTENAME(@dbName);
                                 | | | | | | | | | |   declare @isSingleUser bit = 0;
                                 | | | | | | | | | |   declare @isRCSEnabled int;
                                 | | | | | | | | | |   select @isRCSEnabled = is_read_committed_snapshot_on from sys.databases where name = @dbName;
                                 | | | | | | | | | |   if @isRCSEnabled = 0
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |       exec( 'alter database '+@dbNameQ+' set single_user with rollback immediate;' );
                                 | | | | | | | | | |       set @isSingleUser = 1;
                                 | | | | | | | | | |       exec( 'alter database '+@dbNameQ+' set read_committed_snapshot on;' );
                                 | | | | | | | | | |   end;
                                 | | | | | | | | | |    
                                 | | | | | | | | | |   declare @isSIEnabled int;
                                 | | | | | | | | | |   select @isSIEnabled = snapshot_isolation_state from sys.databases where name = @dbName;
                                 | | | | | | | | | |   if @isSIEnabled = 0
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |       if @isSingleUser = 0 exec ('alter database ' + @dbNameQ + ' set single_user with rollback immediate;');
                                 | | | | | | | | | |       exec( 'alter database '+@dbNameQ+' set allow_snapshot_isolation on;' );
                                 | | | | | | | | | |   end;
                                 | | | | | | | | | |    
                                 | | | | | | | | | |   if @isSingleUser = 1 exec( 'alter database '+@dbNameQ+' set multi_user;' );
   2018-05-30 16h09.34.7646028   | | | | | | | | | | GO
   2018-05-30 16h09.34.8050252 i | | | | | | | | | < 
   2018-05-30 16h09.34.8050252 i | | | | | | | | | > Initializing []db^Model.SqlDatabase.Head
   2018-05-30 16h09.34.8055250 i | | | | | | | | | < 
   2018-05-30 16h09.34.8055250 i | | | | | | | | | > Initializing []db^Model.CK.DB.Actor.Package.Head
   2018-05-30 16h09.34.8055250 i | | | | | | | | | < 
   2018-05-30 16h09.34.8055250 i | | | | | | | | | > Initializing []db^Model.CK.ActorTable.Head
   2018-05-30 16h09.34.8055250 i | | | | | | | | | < 
   2018-05-30 16h09.34.8055250 i | | | | | | | | | > Initializing []db^Model.CK.ActorTable
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.GroupTable.Head
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.UserTable.Head
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.GroupTable
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.UserTable
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.ActorProfileTable.Head
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.ActorProfileTable
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.DB.Actor.Package
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.DB.Auth.Package.Head
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.AuthProviderTable.Head
   2018-05-30 16h09.34.8060239 i | | | | | | | | | < 
   2018-05-30 16h09.34.8060239 i | | | | | | | | | > Initializing []db^Model.CK.AuthProviderTable
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.DB.Auth.Package
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.DB.User.UserGoogle.Package.Head
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.DB.User.UserOidc.Package.Head
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.DB.User.UserPassword.Package.Head
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.UserGoogleTable.Head
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.UserOidcTable.Head
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.UserPasswordTable.Head
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.UserGoogleTable
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8065224 i | | | | | | | | | > Initializing []db^Model.CK.UserOidcTable
   2018-05-30 16h09.34.8065224 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^Model.CK.UserPasswordTable
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^Model.CK.DB.User.UserGoogle.Package
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^Model.CK.DB.User.UserOidc.Package
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^Model.CK.DB.User.UserPassword.Package
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^Model.SqlDatabase
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^SqlDatabase.Head
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^CK.DB.Actor.Package.Head
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^CK.ActorTable.Head
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^CK.sActorCreate
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8070208 i | | | | | | | | | > Initializing []db^CK.ActorTable
   2018-05-30 16h09.34.8070208 i | | | | | | | | | < 
   2018-05-30 16h09.34.8075202 i | | | | | | | | | > Initializing []db^CK.GroupTable.Head
   2018-05-30 16h09.34.8080195 i | | | | | | | | | < 
   2018-05-30 16h09.34.8085184 i | | | | | | | | | > Initializing []db^CK.UserTable.Head
   2018-05-30 16h09.34.8085184 i | | | | | | | | | < 
   2018-05-30 16h09.34.8085184 i | | | | | | | | | > Initializing []db^CK.sGroupCreate
   2018-05-30 16h09.34.8085184 i | | | | | | | | | < 
   2018-05-30 16h09.34.8085184 i | | | | | | | | | > Initializing []db^CK.sGroupUserAdd
   2018-05-30 16h09.34.8085184 i | | | | | | | | | < 
   2018-05-30 16h09.34.8085184 i | | | | | | | | | > Initializing []db^CK.sGroupUserRemove
   2018-05-30 16h09.34.8085184 i | | | | | | | | | < 
   2018-05-30 16h09.34.8085184 i | | | | | | | | | > Initializing []db^CK.sUserCreate
   2018-05-30 16h09.34.8085184 i | | | | | | | | | < 
   2018-05-30 16h09.34.8085184 i | | | | | | | | | > Initializing []db^CK.sUserUserNameSet
   2018-05-30 16h09.34.8085184 i | | | | | | | | | < 
   2018-05-30 16h09.34.8085184 i | | | | | | | | | > Initializing []db^CK.vGroup
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8090178 i | | | | | | | | | > Initializing []db^CK.vUser
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8090178 i | | | | | | | | | > Initializing []db^CK.sGroupRemoveAllUsers
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8090178 i | | | | | | | | | > Initializing []db^CK.sUserRemoveFromAllGroups
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8090178 i | | | | | | | | | > Initializing []db^CK.sGroupDestroy
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8090178 i | | | | | | | | | > Initializing []db^CK.sUserDestroy
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8090178 i | | | | | | | | | > Initializing []db^CK.GroupTable
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8090178 i | | | | | | | | | > Initializing []db^CK.UserTable
   2018-05-30 16h09.34.8090178 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.ActorProfileTable.Head
   2018-05-30 16h09.34.8095167 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.ActorProfileTable
   2018-05-30 16h09.34.8095167 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.DB.Actor.Package
   2018-05-30 16h09.34.8095167 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.DB.Auth.Package.Head
   2018-05-30 16h09.34.8095167 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.AuthProviderTable.Head
   2018-05-30 16h09.34.8095167 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.sAuthUserOnLogin
   2018-05-30 16h09.34.8095167 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.vUserAuthProvider
   2018-05-30 16h09.34.8095167 i | | | | | | | | | < 
   2018-05-30 16h09.34.8095167 i | | | | | | | | | > Initializing []db^CK.sAuthProviderRegister
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.sAuthUserInfoRead
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.AuthProviderTable
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.DB.Auth.Package
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.DB.User.UserGoogle.Package.Head
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.DB.User.UserOidc.Package.Head
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.DB.User.UserPassword.Package.Head
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.DB.User.UserGoogle.Package([]db^CK.vUserAuthProvider)
   2018-05-30 16h09.34.8100160 i | | | | | | | | | < 
   2018-05-30 16h09.34.8100160 i | | | | | | | | | > Initializing []db^CK.DB.User.UserOidc.Package([]db^CK.vUserAuthProvider)
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.DB.User.UserPassword.Package([]db^CK.vUserAuthProvider)
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.UserGoogleTable.Head
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.UserOidcTable.Head
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.UserPasswordTable.Head
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.sUserGoogleDestroy
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.sUserGoogleUCL
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.sUserOidcDestroy
   2018-05-30 16h09.34.8105145 i | | | | | | | | | < 
   2018-05-30 16h09.34.8105145 i | | | | | | | | | > Initializing []db^CK.sUserOidcUCL
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8110139 i | | | | | | | | | > Initializing []db^CK.sUserPasswordDestroy
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8110139 i | | | | | | | | | > Initializing []db^CK.sUserPasswordUCL
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8110139 i | | | | | | | | | > Initializing []db^CK.UserGoogleTable([]db^CK.sUserDestroy)
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8110139 i | | | | | | | | | > Initializing []db^CK.UserOidcTable([]db^CK.sUserDestroy)
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8110139 i | | | | | | | | | > Initializing []db^CK.UserPasswordTable([]db^CK.sUserDestroy)
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8110139 i | | | | | | | | | > Initializing []db^CK.vUserAuthProvider#transform
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8110139 i | | | | | | | | | > Initializing []db^CK.sUserDestroy#transform
   2018-05-30 16h09.34.8110139 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | | > Initializing []db^CK.UserGoogleTable
   2018-05-30 16h09.34.8115132 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | | > Initializing []db^CK.UserOidcTable
   2018-05-30 16h09.34.8115132 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | | > Initializing []db^CK.UserPasswordTable
   2018-05-30 16h09.34.8115132 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | | > Initializing []db^CK.DB.User.UserGoogle.Package
   2018-05-30 16h09.34.8115132 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | | > Initializing []db^CK.DB.User.UserOidc.Package
   2018-05-30 16h09.34.8115132 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | | > Initializing []db^CK.DB.User.UserPassword.Package
   2018-05-30 16h09.34.8115132 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | | > Initializing []db^SqlDatabase
   2018-05-30 16h09.34.8115132 i | | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | < 
   2018-05-30 16h09.34.8115132 i | | | | | | | | > Install step.
   2018-05-30 16h09.34.8125115   | | | | | | | | | > Raising Install setup event.
   2018-05-30 16h09.34.8125115   | | | | | | | | | < 
   2018-05-30 16h09.34.8130108 i | | | | | | | | | > Installing []CK._g.poco.Factory (unversioned).
   2018-05-30 16h09.34.8145075 i | | | | | | | | | < 
   2018-05-30 16h09.34.8145075 i | | | | | | | | | > Installing []db^SqlDatabase.Connection (unversioned).
   2018-05-30 16h09.34.8145075 i | | | | | | | | | < 
   2018-05-30 16h09.34.8145075 i | | | | | | | | | > Installing []db^Model.SqlDatabase.Head (unversioned).
   2018-05-30 16h09.34.8150069 i | | | | | | | | | < 
   2018-05-30 16h09.34.8150069 i | | | | | | | | | > Installing []db^Model.CK.DB.Actor.Package.Head (= 5.0.0 =).
   2018-05-30 16h09.34.8150069 i | | | | | | | | | < 
   2018-05-30 16h09.34.8150069 i | | | | | | | | | > Installing []db^Model.CK.ActorTable.Head (= 5.0.0 =).
   2018-05-30 16h09.34.8150069 i | | | | | | | | | < 
   2018-05-30 16h09.34.8150069 i | | | | | | | | | > Installing []db^Model.CK.ActorTable (= 5.0.0 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8155058 i | | | | | | | | | > Installing []db^Model.CK.GroupTable.Head (= 5.0.1 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8155058 i | | | | | | | | | > Installing []db^Model.CK.UserTable.Head (= 5.0.3 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8155058 i | | | | | | | | | > Installing []db^Model.CK.GroupTable (= 5.0.1 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8155058 i | | | | | | | | | > Installing []db^Model.CK.UserTable (= 5.0.3 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8155058 i | | | | | | | | | > Installing []db^Model.CK.ActorProfileTable.Head (= 5.0.0 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8155058 i | | | | | | | | | > Installing []db^Model.CK.ActorProfileTable (= 5.0.0 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8155058 i | | | | | | | | | > Installing []db^Model.CK.DB.Actor.Package (= 5.0.0 =).
   2018-05-30 16h09.34.8155058 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.DB.Auth.Package.Head (= 1.0.0 =).
   2018-05-30 16h09.34.8160051 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.AuthProviderTable.Head (= 1.0.2 =).
   2018-05-30 16h09.34.8160051 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.AuthProviderTable (= 1.0.2 =).
   2018-05-30 16h09.34.8160051 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.DB.Auth.Package (= 1.0.0 =).
   2018-05-30 16h09.34.8160051 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.DB.User.UserGoogle.Package.Head (= 1.0.0 =).
   2018-05-30 16h09.34.8160051 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.DB.User.UserOidc.Package.Head (= 1.0.0 =).
   2018-05-30 16h09.34.8160051 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.DB.User.UserPassword.Package.Head (= 1.0.1 =).
   2018-05-30 16h09.34.8160051 i | | | | | | | | | < 
   2018-05-30 16h09.34.8160051 i | | | | | | | | | > Installing []db^Model.CK.UserGoogleTable.Head (= 2.0.1 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8165036 i | | | | | | | | | > Installing []db^Model.CK.UserOidcTable.Head (= 2.0.1 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8165036 i | | | | | | | | | > Installing []db^Model.CK.UserPasswordTable.Head (= 1.0.2 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8165036 i | | | | | | | | | > Installing []db^Model.CK.UserGoogleTable (= 2.0.1 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8165036 i | | | | | | | | | > Installing []db^Model.CK.UserOidcTable (= 2.0.1 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8165036 i | | | | | | | | | > Installing []db^Model.CK.UserPasswordTable (= 1.0.2 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8165036 i | | | | | | | | | > Installing []db^Model.CK.DB.User.UserGoogle.Package (= 1.0.0 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8165036 i | | | | | | | | | > Installing []db^Model.CK.DB.User.UserOidc.Package (= 1.0.0 =).
   2018-05-30 16h09.34.8165036 i | | | | | | | | | < 
   2018-05-30 16h09.34.8170029 i | | | | | | | | | > Installing []db^Model.CK.DB.User.UserPassword.Package (= 1.0.1 =).
   2018-05-30 16h09.34.8170029 i | | | | | | | | | < 
   2018-05-30 16h09.34.8170029 i | | | | | | | | | > Installing []db^Model.SqlDatabase (unversioned).
   2018-05-30 16h09.34.8170029 i | | | | | | | | | < 
   2018-05-30 16h09.34.8170029 i | | | | | | | | | > Installing []db^SqlDatabase.Head (unversioned).
   2018-05-30 16h09.34.8170029 i | | | | | | | | | < 
   2018-05-30 16h09.34.8170029 i | | | | | | | | | > Installing []db^CK.DB.Actor.Package.Head (= 5.0.0 =).
   2018-05-30 16h09.34.8170029 i | | | | | | | | | < 
   2018-05-30 16h09.34.8170029 i | | | | | | | | | > Installing []db^CK.ActorTable.Head (= 5.0.0 =).
   2018-05-30 16h09.34.8170029 i | | | | | | | | | < 
   2018-05-30 16h09.34.8170029 i | | | | | | | | | > Installing []db^CK.sActorCreate (unversioned).
   2018-05-30 16h09.34.8254870   | | | | | | | | | | if OBJECT_ID('CK.sActorCreate') is not null drop Procedure CK.sActorCreate;
   2018-05-30 16h09.34.8254870   | | | | | | | | | | GO
   2018-05-30 16h09.34.8659125   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   create procedure CK.sActorCreate 
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@ActorIdResult int output
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<PreCreate revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	insert into CK.tActor default values;
                                 | | | | | | | | | |   	set @ActorIdResult = SCOPE_IDENTITY();
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	-- The actor is in its own group.
                                 | | | | | | | | | |   	insert into CK.tActorProfile( ActorId, GroupId ) values( @ActorIdResult, @ActorIdResult );
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PostCreate />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.8659125   | | | | | | | | | | GO
   2018-05-30 16h09.34.8684084 i | | | | | | | | | < 
   2018-05-30 16h09.34.8684084 i | | | | | | | | | > Installing []db^CK.ActorTable (= 5.0.0 =).
   2018-05-30 16h09.34.8684084 i | | | | | | | | | < 
   2018-05-30 16h09.34.8684084 i | | | | | | | | | > Installing []db^CK.GroupTable.Head (= 5.0.1 =).
   2018-05-30 16h09.34.8684084 i | | | | | | | | | < 
   2018-05-30 16h09.34.8684084 i | | | | | | | | | > Installing []db^CK.UserTable.Head (= 5.0.3 =).
   2018-05-30 16h09.34.8684084 i | | | | | | | | | < 
   2018-05-30 16h09.34.8684084 i | | | | | | | | | > Installing []db^CK.sGroupCreate (unversioned).
   2018-05-30 16h09.34.8689091   | | | | | | | | | | if OBJECT_ID('CK.sGroupCreate') is not null drop Procedure CK.sGroupCreate;
   2018-05-30 16h09.34.8689091   | | | | | | | | | | GO
   2018-05-30 16h09.34.8729017   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sActorCreate" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Creates a Group.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sGroupCreate 
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@GroupIdResult int output
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<PreCreate revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	exec CK.sActorCreate @ActorId, @GroupIdResult output;
                                 | | | | | | | | | |   	insert into CK.tGroup( GroupId ) values( @GroupIdResult );
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PostCreate />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.8734006   | | | | | | | | | | GO
   2018-05-30 16h09.34.8765511 i | | | | | | | | | < 
   2018-05-30 16h09.34.8765511 i | | | | | | | | | > Installing []db^CK.sGroupUserAdd (unversioned).
   2018-05-30 16h09.34.8770473   | | | | | | | | | | if OBJECT_ID('CK.sGroupUserAdd') is not null drop Procedure CK.sGroupUserAdd;
   2018-05-30 16h09.34.8770473   | | | | | | | | | | GO
   2018-05-30 16h09.34.9005029   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Add a User to a Group. Does nothing if the User is already in the Group.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sGroupUserAdd 
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@GroupId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @GroupId <= 0 throw 50000, 'Group.InvalidId', 1;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	-- System is, somehow, already in all groups.
                                 | | | | | | | | | |       if @UserId = 1 return 0;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   if @GroupId <> @UserId and not exists (select * from CK.tActorProfile where GroupId = @GroupId and ActorId = @UserId)
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		-- If this is the System Group, only members of it can add new Users.
                                 | | | | | | | | | |   		if @GroupId = 1 
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |   			if not exists( select 1 from CK.tActorProfile p where p.GroupId = 1 and p.ActorId = @ActorId ) 
                                 | | | | | | | | | |   			begin
                                 | | | | | | | | | |   				;throw 50000, 'Security.ActorMustBeSytem', 1;
                                 | | | | | | | | | |   			end
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PreUserAdd revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		insert into CK.tActorProfile( ActorId, GroupId ) values( @UserId, @GroupId );
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PostUserAdd />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9005029   | | | | | | | | | | GO
   2018-05-30 16h09.34.9039984 i | | | | | | | | | < 
   2018-05-30 16h09.34.9039984 i | | | | | | | | | > Installing []db^CK.sGroupUserRemove (unversioned).
   2018-05-30 16h09.34.9039984   | | | | | | | | | | if OBJECT_ID('CK.sGroupUserRemove') is not null drop Procedure CK.sGroupUserRemove;
   2018-05-30 16h09.34.9039984   | | | | | | | | | | GO
   2018-05-30 16h09.34.9099853   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Removes a User from a Group.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sGroupUserRemove
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@GroupId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @GroupId <= 0 throw 50000, 'Group.InvalidId', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   if @GroupId <> @UserId and exists (select * from CK.tActorProfile where GroupId = @GroupId and ActorId = @UserId)
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		-- If this is the System Group, only members of it can remove Users.
                                 | | | | | | | | | |   		if @GroupId = 1 
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |   			if not exists( select 1 from CK.tActorProfile p where p.GroupId = 1 and p.ActorId = @ActorId ) 
                                 | | | | | | | | | |   			begin
                                 | | | | | | | | | |   				;throw 50000, 'Security.ActorMustBeSytem', 1;
                                 | | | | | | | | | |   			end
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PreUserRemove revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		delete from CK.tActorProfile where GroupId = @GroupId and ActorId = @UserId;
                                 | | | | | | | | | |   		
                                 | | | | | | | | | |   		--<PostUserRemove />
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9099853   | | | | | | | | | | GO
   2018-05-30 16h09.34.9134794 i | | | | | | | | | < 
   2018-05-30 16h09.34.9139818 i | | | | | | | | | > Installing []db^CK.sUserCreate (unversioned).
   2018-05-30 16h09.34.9139818   | | | | | | | | | | if OBJECT_ID('CK.sUserCreate') is not null drop Procedure CK.sUserCreate;
   2018-05-30 16h09.34.9139818   | | | | | | | | | | GO
   2018-05-30 16h09.34.9159891   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sActorCreate" ] }
                                 | | | | | | | | | |   create procedure CK.sUserCreate 
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserName nvarchar( 255 ),
                                 | | | | | | | | | |   	@UserIdResult int output
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   set @UserIdResult = 0;
                                 | | | | | | | | | |   	if exists( select UserId from CK.tUser where UserName = @UserName )
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		set @UserIdResult = -1;
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	if @UserIdResult = 0
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		--<PreCreate revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sActorCreate @ActorId, @UserIdResult output;
                                 | | | | | | | | | |   		insert into CK.tUser( UserId, UserName ) values ( @UserIdResult, @UserName );
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PostCreate />
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9164755   | | | | | | | | | | GO
   2018-05-30 16h09.34.9189700 i | | | | | | | | | < 
   2018-05-30 16h09.34.9189700 i | | | | | | | | | > Installing []db^CK.sUserUserNameSet (unversioned).
   2018-05-30 16h09.34.9189700   | | | | | | | | | | if OBJECT_ID('CK.sUserUserNameSet') is not null drop Procedure CK.sUserUserNameSet;
   2018-05-30 16h09.34.9189700   | | | | | | | | | | GO
   2018-05-30 16h09.34.9214797   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   -- Sets the user name. 
                                 | | | | | | | | | |   -- There is no guaranty that the actual value will be the same as the one requested (if auto numbering 
                                 | | | | | | | | | |   -- is injected for example). 
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserUserNameSet
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |       @ActorId int,
                                 | | | | | | | | | |       @UserId int,
                                 | | | | | | | | | |       @UserName nvarchar(127),
                                 | | | | | | | | | |   	@Done bit output
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   set @Done = 1;
                                 | | | | | | | | | |   	if exists( select * from CK.tUser where UserName = @UserName and UserId <> @UserId )
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		set @Done = 0;
                                 | | | | | | | | | |   		--<UserNameSetClash />
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	if @Done = 1
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		--<PreUserNameSet revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		update u 
                                 | | | | | | | | | |   			set u.UserName = @UserName
                                 | | | | | | | | | |   			from CK.tUser u   
                                 | | | | | | | | | |   			where u.UserId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PostUserNameSet />
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9214797   | | | | | | | | | | GO
   2018-05-30 16h09.34.9234592 i | | | | | | | | | < 
   2018-05-30 16h09.34.9234592 i | | | | | | | | | > Installing []db^CK.vGroup (unversioned).
   2018-05-30 16h09.34.9239742   | | | | | | | | | | if OBJECT_ID('CK.vGroup') is not null drop View CK.vGroup;
   2018-05-30 16h09.34.9239742   | | | | | | | | | | GO
   2018-05-30 16h09.34.9274692   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   create view CK.vGroup
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   	select  g.GroupId,
                                 | | | | | | | | | |   			GroupName = N'#Group-' +  cast(g.GroupId as varchar) collate Latin1_General_100_CI_AI,
                                 | | | | | | | | | |   			UserCount = (select count(*) 
                                 | | | | | | | | | |   							from CK.tUser u with(nolock) 
                                 | | | | | | | | | |   							inner join CK.tActorProfile p with(nolock) on p.ActorId = u.UserId
                                 | | | | | | | | | |   							where p.GroupId = g.GroupId)
                                 | | | | | | | | | |   		from CK.tGroup g;
   2018-05-30 16h09.34.9274692   | | | | | | | | | | GO
   2018-05-30 16h09.34.9294483 i | | | | | | | | | < 
   2018-05-30 16h09.34.9294483 i | | | | | | | | | > Installing []db^CK.vUser (unversioned).
   2018-05-30 16h09.34.9299481   | | | | | | | | | | if OBJECT_ID('CK.vUser') is not null drop View CK.vUser;
   2018-05-30 16h09.34.9299481   | | | | | | | | | | GO
   2018-05-30 16h09.34.9321173   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   create view CK.vUser
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   	select  u.UserId,
                                 | | | | | | | | | |   			u.CreationDate,
                                 | | | | | | | | | |   			u.UserName
                                 | | | | | | | | | |   		from CK.tUser u;
   2018-05-30 16h09.34.9321173   | | | | | | | | | | GO
   2018-05-30 16h09.34.9336225 i | | | | | | | | | < 
   2018-05-30 16h09.34.9336225 i | | | | | | | | | > Installing []db^CK.sGroupRemoveAllUsers (unversioned).
   2018-05-30 16h09.34.9336225   | | | | | | | | | | if OBJECT_ID('CK.sGroupRemoveAllUsers') is not null drop Procedure CK.sGroupRemoveAllUsers;
   2018-05-30 16h09.34.9341219   | | | | | | | | | | GO
   2018-05-30 16h09.34.9390337   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sGroupUserRemove" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Clears a Group.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sGroupRemoveAllUsers
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@GroupId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @GroupId <= 0 throw 50000, 'Group.InvalidGroup', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   declare @UserId int;
                                 | | | | | | | | | |   	declare @CUser cursor;
                                 | | | | | | | | | |   	set @CUser = cursor local fast_forward for 
                                 | | | | | | | | | |   		select ActorId from CK.tActorProfile p 
                                 | | | | | | | | | |   						inner join CK.tUser u on u.UserId = p.ActorId
                                 | | | | | | | | | |   						where p.GroupId = @GroupId and p.ActorId <> @GroupId;
                                 | | | | | | | | | |   	open @CUser;
                                 | | | | | | | | | |   	fetch from @CUser into @UserId;
                                 | | | | | | | | | |   	while @@FETCH_STATUS = 0
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		exec CK.sGroupUserRemove @ActorId, @GroupId, @UserId;
                                 | | | | | | | | | |   		fetch next from @CUser into @UserId;
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	deallocate @CUser;
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9390337   | | | | | | | | | | GO
   2018-05-30 16h09.34.9415448 i | | | | | | | | | < 
   2018-05-30 16h09.34.9415448 i | | | | | | | | | > Installing []db^CK.sUserRemoveFromAllGroups (unversioned).
   2018-05-30 16h09.34.9415448   | | | | | | | | | | if OBJECT_ID('CK.sUserRemoveFromAllGroups') is not null drop Procedure CK.sUserRemoveFromAllGroups;
   2018-05-30 16h09.34.9415448   | | | | | | | | | | GO
   2018-05-30 16h09.34.9455217   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sGroupUserRemove" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Removes a User from all the Groups it belongs to.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserRemoveFromAllGroups
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   declare @GroupId int;
                                 | | | | | | | | | |   	declare @CGroup cursor;
                                 | | | | | | | | | |   	set @CGroup = cursor local fast_forward for 
                                 | | | | | | | | | |   		select GroupId from CK.tActorProfile where ActorId = @UserId and GroupId <> @UserId;
                                 | | | | | | | | | |   	open @CGroup
                                 | | | | | | | | | |   	fetch from @CGroup into @GroupId
                                 | | | | | | | | | |   	while @@FETCH_STATUS = 0
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		exec CK.sGroupUserRemove @ActorId, @GroupId, @UserId;
                                 | | | | | | | | | |   		fetch next from @CGroup into @GroupId;
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	deallocate @CGroup;
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9455217   | | | | | | | | | | GO
   2018-05-30 16h09.34.9480189 i | | | | | | | | | < 
   2018-05-30 16h09.34.9480189 i | | | | | | | | | > Installing []db^CK.sGroupDestroy (unversioned).
   2018-05-30 16h09.34.9480189   | | | | | | | | | | if OBJECT_ID('CK.sGroupDestroy') is not null drop Procedure CK.sGroupDestroy;
   2018-05-30 16h09.34.9480189   | | | | | | | | | | GO
   2018-05-30 16h09.34.9515103   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sGroupRemoveAllUsers" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Destroys a Group: can work only if there is no Users inside the Group except if @ForceDestroy = 1.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sGroupDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@GroupId int,
                                 | | | | | | | | | |   	@ForceDestroy bit = 0
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @GroupId <= 1 throw 50000, 'Group.Undestroyable', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<PreDestroy revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	if @ForceDestroy = 1
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		exec CK.sGroupRemoveAllUsers @ActorId, @GroupId;
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	else
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		if exists( select * from CK.tActorProfile where GroupId = @GroupId and ActorId <> @GroupId ) throw 50000, 'Group.NotEmptyGroup', 1;
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	delete from CK.tActorProfile where GroupId = @GroupId;
                                 | | | | | | | | | |   	delete from CK.tGroup where GroupId = @GroupId;
                                 | | | | | | | | | |   	delete from CK.tActor where ActorId = @GroupId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PostDestroy />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9515103   | | | | | | | | | | GO
   2018-05-30 16h09.34.9550040 i | | | | | | | | | < 
   2018-05-30 16h09.34.9550040 i | | | | | | | | | > Installing []db^CK.sUserDestroy (unversioned).
   2018-05-30 16h09.34.9555029   | | | | | | | | | | if OBJECT_ID('CK.sUserDestroy') is not null drop Procedure CK.sUserDestroy;
   2018-05-30 16h09.34.9555029   | | | | | | | | | | GO
   2018-05-30 16h09.34.9609931   | | | | | | | | | | -- This will be transformed by []db^CK.UserGoogleTable([]db^CK.sUserDestroy), []db^CK.UserOidcTable([]db^CK.sUserDestroy), []db^CK.UserPasswordTable([]db^CK.sUserDestroy)
                                 | | | | | | | | | |   -- SetupConfig: { "Requires": [ "CK.sUserRemoveFromAllGroups" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Destroys a User: automatically removes it from any Groups it may belong to.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId <= 1 throw 50000, 'User.Undestroyable', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   if exists( select * from CK.tUser where UserId = @UserId )
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		--<PreDestroy revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserRemoveFromAllGroups @ActorId, @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		delete from CK.tActorProfile where ActorId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tUser where UserId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tActor where ActorId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PostDestroy />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9614947   | | | | | | | | | | GO
   2018-05-30 16h09.34.9659960 i | | | | | | | | | < 
   2018-05-30 16h09.34.9664837 i | | | | | | | | | > Installing []db^CK.GroupTable (= 5.0.1 =).
   2018-05-30 16h09.34.9664837 i | | | | | | | | | < 
   2018-05-30 16h09.34.9664837 i | | | | | | | | | > Installing []db^CK.UserTable (= 5.0.3 =).
   2018-05-30 16h09.34.9664837 i | | | | | | | | | < 
   2018-05-30 16h09.34.9664837 i | | | | | | | | | > Installing []db^CK.ActorProfileTable.Head (= 5.0.0 =).
   2018-05-30 16h09.34.9664837 i | | | | | | | | | < 
   2018-05-30 16h09.34.9664837 i | | | | | | | | | > Installing []db^CK.ActorProfileTable (= 5.0.0 =).
   2018-05-30 16h09.34.9664837 i | | | | | | | | | < 
   2018-05-30 16h09.34.9664837 i | | | | | | | | | > Installing []db^CK.DB.Actor.Package (= 5.0.0 =).
   2018-05-30 16h09.34.9669826 i | | | | | | | | | < 
   2018-05-30 16h09.34.9669826 i | | | | | | | | | > Installing []db^CK.DB.Auth.Package.Head (= 1.0.0 =).
   2018-05-30 16h09.34.9669826 i | | | | | | | | | < 
   2018-05-30 16h09.34.9669826 i | | | | | | | | | > Installing []db^CK.AuthProviderTable.Head (= 1.0.2 =).
   2018-05-30 16h09.34.9669826 i | | | | | | | | | < 
   2018-05-30 16h09.34.9669826 i | | | | | | | | | > Installing []db^CK.sAuthUserOnLogin (unversioned).
   2018-05-30 16h09.34.9669826   | | | | | | | | | | if OBJECT_ID('CK.sAuthUserOnLogin') is not null drop Procedure CK.sAuthUserOnLogin;
   2018-05-30 16h09.34.9674806   | | | | | | | | | | GO
   2018-05-30 16h09.34.9800345   | | | | | | | | | | -- SetupConfig: { }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Both @FailureCode and @FailureReason can be set.
                                 | | | | | | | | | |   -- 
                                 | | | | | | | | | |   -- @LastLoginTime:  Last login time ('0001-01-01' for first login).</param>
                                 | | | | | | | | | |   -- @LoginTimeNow:   Current login time. This is the exact time that will become, on success, the LastLoginTime
                                 | | | | | | | | | |   --                  in the provider table.
                                 | | | | | | | | | |   -- @ActualLogin:    True for an actual login. False otherwise: only checks must be done.
                                 | | | | | | | | | |   -- @FailureCode:    To reject login, set this to a non null value (should be greater to 0).
                                 | | | | | | | | | |   -- @FailureReason:  Optional (may be deduced from @FailureCode). If set to a non null string and @FailureCode
                                 | | | | | | | | | |   --                  is not set, @FailureCode is set to 1 (Unspecified).
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   --  On output these 2 variables are normalized to be both null if login succeeds or non null on failure.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sAuthUserOnLogin
                                 | | | | | | | | | |   ( 
                                 | | | | | | | | | |   	@Scheme varchar(64),
                                 | | | | | | | | | |   	@LastLoginTime datetime2(2),
                                 | | | | | | | | | |   	@UserId int,
                                 | | | | | | | | | |       @ActualLogin bit,
                                 | | | | | | | | | |   	@LoginTimeNow datetime2(2),
                                 | | | | | | | | | |       @FailureCode int output,
                                 | | | | | | | | | |       @FailureReason nvarchar(255) output
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<CheckLoginFailure />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |       if @FailureReason is not null or @FailureCode is not null
                                 | | | | | | | | | |       begin
                                 | | | | | | | | | |           -- Normalize @FailureCode: always positive.
                                 | | | | | | | | | |           if @FailureCode is null or @FailureCode = 0 set @FailureCode = 1; -- Unspecified
                                 | | | | | | | | | |           else if @FailureCode < 0 set @FailureCode = -@FailureCode;
                                 | | | | | | | | | |           -- Normalize @FailureReason (trim) and back to null if empty.
                                 | | | | | | | | | |           set @FailureReason = rtrim(ltrim(@FailureReason));
                                 | | | | | | | | | |           if len(@FailureReason) = 0 set @FailureReason = null;
                                 | | | | | | | | | |       end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |       --<PostCheck />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |       if @ActualLogin = 1
                                 | | | | | | | | | |       begin
                                 | | | | | | | | | |           if @FailureCode is null
                                 | | | | | | | | | |           begin
                                 | | | | | | | | | |               declare @unused1 int;
                                 | | | | | | | | | |               --<LoginSucceed />
                                 | | | | | | | | | |           end
                                 | | | | | | | | | |           else
                                 | | | | | | | | | |           begin
                                 | | | | | | | | | |               declare @unused2 int;
                                 | | | | | | | | | |               --<LoginFailed />
                                 | | | | | | | | | |           end
                                 | | | | | | | | | |       end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.34.9800345   | | | | | | | | | | GO
   2018-05-30 16h09.34.9863627 i | | | | | | | | | < 
   2018-05-30 16h09.34.9863627 i | | | | | | | | | > Installing []db^CK.vUserAuthProvider (unversioned).
   2018-05-30 16h09.34.9868616   | | | | | | | | | | if OBJECT_ID('CK.vUserAuthProvider') is not null drop View CK.vUserAuthProvider;
   2018-05-30 16h09.34.9868616   | | | | | | | | | | GO
   2018-05-30 16h09.34.9938472   | | | | | | | | | | -- This will be transformed by []db^CK.DB.User.UserGoogle.Package([]db^CK.vUserAuthProvider), []db^CK.DB.User.UserOidc.Package([]db^CK.vUserAuthProvider), []db^CK.DB.User.UserPassword.Package([]db^CK.vUserAuthProvider)
                                 | | | | | | | | | |   -- SetupConfig: { } 
                                 | | | | | | | | | |   -- 
                                 | | | | | | | | | |   -- This view is an union all of selects injected by the different providers.
                                 | | | | | | | | | |   -- The first record is a fake one (filtered with an always false clause) that eases
                                 | | | | | | | | | |   -- the injection and describes the expected data model.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- The LastUsed can be '0001-01-01 00:00:00' (that is equal to DateTime.MinValue or CK.Core.Util.DateTime.UtcMinValue) 
                                 | | | | | | | | | |   -- in this view if a user has been registered in the provider but has not actually logged in yet.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- An exemple of a transformer (the one from Google provider):
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   --		-- SetupConfig: { "AddRequires": "Model.CK.UserGoogleTable" } 
                                 | | | | | | | | | |   --		-- 
                                 | | | | | | | | | |   --		create transformer on CK.vUserAuthProvider
                                 | | | | | | | | | |   --		as
                                 | | | | | | | | | |   --		begin
                                 | | | | | | | | | |   --			inject "
                                 | | | | | | | | | |   --			union all
                                 | | | | | | | | | |   --			select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   --			" after first part {select};
                                 | | | | | | | | | |   --		end
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create view CK.vUserAuthProvider( UserId, Scheme, LastUsed )
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   	select	UserId = 0, Scheme = 'Scheme (ProviderName when IsMultiScheme = 0)', LastUsed = 'non null datetime2(2)' -- (provider table).LastLoginTime
                                 | | | | | | | | | |   		from CKCore.tSystem where 1 = 0;
   2018-05-30 16h09.34.9943465   | | | | | | | | | | GO
   2018-05-30 16h09.35.0024963 i | | | | | | | | | < 
   2018-05-30 16h09.35.0024963 i | | | | | | | | | > Installing []db^CK.sAuthProviderRegister (unversioned).
   2018-05-30 16h09.35.0029957   | | | | | | | | | | if OBJECT_ID('CK.sAuthProviderRegister') is not null drop Procedure CK.sAuthProviderRegister;
   2018-05-30 16h09.35.0029957   | | | | | | | | | | GO
   2018-05-30 16h09.35.0110366   | | | | | | | | | | -- SetupConfig: { } 
                                 | | | | | | | | | |   -- 
                                 | | | | | | | | | |   create procedure CK.sAuthProviderRegister
                                 | | | | | | | | | |   ( 
                                 | | | | | | | | | |   	@ActorId int, 
                                 | | | | | | | | | |   	@ProviderName varchar(64),
                                 | | | | | | | | | |   	@UserProviderSchemaTableName nvarchar(128),
                                 | | | | | | | | | |   	@IsMultiScheme bit,
                                 | | | | | | | | | |   	@AuthProviderIdResult int output
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<PreCreate revert />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	insert CK.tAuthProvider( ProviderName, UserProviderSchemaTableName, IsMultiScheme ) 
                                 | | | | | | | | | |   		values( @ProviderName, @UserProviderSchemaTableName, @IsMultiScheme );
                                 | | | | | | | | | |   	set @AuthProviderIdResult = scope_identity();
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PostCreate />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.0110366   | | | | | | | | | | GO
   2018-05-30 16h09.35.0140314 i | | | | | | | | | < 
   2018-05-30 16h09.35.0140314 i | | | | | | | | | > Installing []db^CK.sAuthUserInfoRead (unversioned).
   2018-05-30 16h09.35.0140314   | | | | | | | | | | if OBJECT_ID('CK.sAuthUserInfoRead') is not null drop Procedure CK.sAuthUserInfoRead;
   2018-05-30 16h09.35.0140314   | | | | | | | | | | GO
   2018-05-30 16h09.35.0190334   | | | | | | | | | | -- SetupConfig: { "Requires": "CK.vUserAuthProvider" } 
                                 | | | | | | | | | |   -- 
                                 | | | | | | | | | |   create procedure CK.sAuthUserInfoRead
                                 | | | | | | | | | |   ( 
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |   	select UserId, UserName from CK.tUser with(nolock) where UserId = @UserId and @UserId > 0;
                                 | | | | | | | | | |   	select Scheme, LastUsed 
                                 | | | | | | | | | |   		from CK.vUserAuthProvider with(nolock) 
                                 | | | | | | | | | |   		where UserId = @UserId and LastUsed > '0001-01-01'
                                 | | | | | | | | | |   		order by LastUsed desc;
                                 | | | | | | | | | |   	return 0;
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.0190334   | | | | | | | | | | GO
   2018-05-30 16h09.35.0205194 i | | | | | | | | | < 
   2018-05-30 16h09.35.0210192 i | | | | | | | | | > Installing []db^CK.AuthProviderTable (= 1.0.2 =).
   2018-05-30 16h09.35.0210192 i | | | | | | | | | < 
   2018-05-30 16h09.35.0210192 i | | | | | | | | | > Installing []db^CK.DB.Auth.Package (= 1.0.0 =).
   2018-05-30 16h09.35.0210192 i | | | | | | | | | < 
   2018-05-30 16h09.35.0210192 i | | | | | | | | | > Installing []db^CK.DB.User.UserGoogle.Package.Head (= 1.0.0 =).
   2018-05-30 16h09.35.0210192 i | | | | | | | | | < 
   2018-05-30 16h09.35.0210192 i | | | | | | | | | > Installing []db^CK.DB.User.UserOidc.Package.Head (= 1.0.0 =).
   2018-05-30 16h09.35.0210192 i | | | | | | | | | < 
   2018-05-30 16h09.35.0210192 i | | | | | | | | | > Installing []db^CK.DB.User.UserPassword.Package.Head (= 1.0.1 =).
   2018-05-30 16h09.35.0210192 i | | | | | | | | | < 
   2018-05-30 16h09.35.0210192 i | | | | | | | | | > Installing []db^CK.DB.User.UserGoogle.Package([]db^CK.vUserAuthProvider) (unversioned).
   2018-05-30 16h09.35.0774288   | | | | | | | | | | Successfully applied 'inject "
                                 | | | | | | | | | |   	union all
                                 | | | | | | | | | |   	select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   	" after first part {select};'.
   2018-05-30 16h09.35.0779139   | | | | | | | | | | > Parsing transformation result.
   2018-05-30 16h09.35.0814205   | | | | | | | | | | < 
   2018-05-30 16h09.35.0839008   | | | | | | | | | | -- SetupConfig: { } 
                                 | | | | | | | | | |   -- 
                                 | | | | | | | | | |   -- This view is an union all of selects injected by the different providers.
                                 | | | | | | | | | |   -- The first record is a fake one (filtered with an always false clause) that eases
                                 | | | | | | | | | |   -- the injection and describes the expected data model.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- The LastUsed can be '0001-01-01 00:00:00' (that is equal to DateTime.MinValue or CK.Core.Util.DateTime.UtcMinValue) 
                                 | | | | | | | | | |   -- in this view if a user has been registered in the provider but has not actually logged in yet.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- An exemple of a transformer (the one from Google provider):
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   --		-- SetupConfig: { "AddRequires": "Model.CK.UserGoogleTable" } 
                                 | | | | | | | | | |   --		-- 
                                 | | | | | | | | | |   --		create transformer on CK.vUserAuthProvider
                                 | | | | | | | | | |   --		as
                                 | | | | | | | | | |   --		begin
                                 | | | | | | | | | |   --			inject "
                                 | | | | | | | | | |   --			union all
                                 | | | | | | | | | |   --			select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   --			" after first part {select};
                                 | | | | | | | | | |   --		end
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   alter view CK.vUserAuthProvider( UserId, Scheme, LastUsed )
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   	select	UserId = 0, Scheme = 'Scheme (ProviderName when IsMultiScheme = 0)', LastUsed = 'non null datetime2(2)' -- (provider table).LastLoginTime
                                 | | | | | | | | | |   		from CKCore.tSystem where 1 = 0
                                 | | | | | | | | | |   	union all
                                 | | | | | | | | | |   	select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   	;
   2018-05-30 16h09.35.0839008   | | | | | | | | | | GO
   2018-05-30 16h09.35.0869076 i | | | | | | | | | < 
   2018-05-30 16h09.35.0869076 i | | | | | | | | | > Installing []db^CK.DB.User.UserOidc.Package([]db^CK.vUserAuthProvider) (unversioned).
   2018-05-30 16h09.35.0898965   | | | | | | | | | | Successfully applied 'inject "
                                 | | | | | | | | | |   	union all
                                 | | | | | | | | | |   	select UserId, Scheme, LastLoginTime from CK.tUserOidc where UserId > 0
                                 | | | | | | | | | |   	" after first part {select};'.
   2018-05-30 16h09.35.0898965   | | | | | | | | | | > Parsing transformation result.
   2018-05-30 16h09.35.0904044   | | | | | | | | | | < 
   2018-05-30 16h09.35.0914026   | | | | | | | | | | -- SetupConfig: { } 
                                 | | | | | | | | | |   -- 
                                 | | | | | | | | | |   -- This view is an union all of selects injected by the different providers.
                                 | | | | | | | | | |   -- The first record is a fake one (filtered with an always false clause) that eases
                                 | | | | | | | | | |   -- the injection and describes the expected data model.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- The LastUsed can be '0001-01-01 00:00:00' (that is equal to DateTime.MinValue or CK.Core.Util.DateTime.UtcMinValue) 
                                 | | | | | | | | | |   -- in this view if a user has been registered in the provider but has not actually logged in yet.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- An exemple of a transformer (the one from Google provider):
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   --		-- SetupConfig: { "AddRequires": "Model.CK.UserGoogleTable" } 
                                 | | | | | | | | | |   --		-- 
                                 | | | | | | | | | |   --		create transformer on CK.vUserAuthProvider
                                 | | | | | | | | | |   --		as
                                 | | | | | | | | | |   --		begin
                                 | | | | | | | | | |   --			inject "
                                 | | | | | | | | | |   --			union all
                                 | | | | | | | | | |   --			select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   --			" after first part {select};
                                 | | | | | | | | | |   --		end
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   alter view CK.vUserAuthProvider( UserId, Scheme, LastUsed )
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   	select	UserId = 0, Scheme = 'Scheme (ProviderName when IsMultiScheme = 0)', LastUsed = 'non null datetime2(2)' -- (provider table).LastLoginTime
                                 | | | | | | | | | |   		from CKCore.tSystem where 1 = 0
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	union all
                                 | | | | | | | | | |   	select UserId, Scheme, LastLoginTime from CK.tUserOidc where UserId > 0
                                 | | | | | | | | | |   		union all
                                 | | | | | | | | | |   	select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   	;
   2018-05-30 16h09.35.0918864   | | | | | | | | | | GO
   2018-05-30 16h09.35.0948811 i | | | | | | | | | < 
   2018-05-30 16h09.35.0948811 i | | | | | | | | | > Installing []db^CK.DB.User.UserPassword.Package([]db^CK.vUserAuthProvider) (unversioned).
   2018-05-30 16h09.35.0953805   | | | | | | | | | | Successfully applied 'inject "
                                 | | | | | | | | | |   	union all
                                 | | | | | | | | | |   	select UserId, 'Basic', case LastLoginTime when '0001-01-01' then null else LastLoginTime end from CK.tUserPassword where UserId > 0
                                 | | | | | | | | | |   	" after first part {select};'.
   2018-05-30 16h09.35.0953805   | | | | | | | | | | > Parsing transformation result.
   2018-05-30 16h09.35.0968799   | | | | | | | | | | < 
   2018-05-30 16h09.35.0978768   | | | | | | | | | | -- SetupConfig: { } 
                                 | | | | | | | | | |   -- 
                                 | | | | | | | | | |   -- This view is an union all of selects injected by the different providers.
                                 | | | | | | | | | |   -- The first record is a fake one (filtered with an always false clause) that eases
                                 | | | | | | | | | |   -- the injection and describes the expected data model.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- The LastUsed can be '0001-01-01 00:00:00' (that is equal to DateTime.MinValue or CK.Core.Util.DateTime.UtcMinValue) 
                                 | | | | | | | | | |   -- in this view if a user has been registered in the provider but has not actually logged in yet.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- An exemple of a transformer (the one from Google provider):
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   --		-- SetupConfig: { "AddRequires": "Model.CK.UserGoogleTable" } 
                                 | | | | | | | | | |   --		-- 
                                 | | | | | | | | | |   --		create transformer on CK.vUserAuthProvider
                                 | | | | | | | | | |   --		as
                                 | | | | | | | | | |   --		begin
                                 | | | | | | | | | |   --			inject "
                                 | | | | | | | | | |   --			union all
                                 | | | | | | | | | |   --			select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   --			" after first part {select};
                                 | | | | | | | | | |   --		end
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   alter view CK.vUserAuthProvider( UserId, Scheme, LastUsed )
                                 | | | | | | | | | |   as 
                                 | | | | | | | | | |   	select	UserId = 0, Scheme = 'Scheme (ProviderName when IsMultiScheme = 0)', LastUsed = 'non null datetime2(2)' -- (provider table).LastLoginTime
                                 | | | | | | | | | |   		from CKCore.tSystem where 1 = 0
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	union all
                                 | | | | | | | | | |   	select UserId, 'Basic', case LastLoginTime when '0001-01-01' then null else LastLoginTime end from CK.tUserPassword where UserId > 0
                                 | | | | | | | | | |   	
                                 | | | | | | | | | |   	union all
                                 | | | | | | | | | |   	select UserId, Scheme, LastLoginTime from CK.tUserOidc where UserId > 0
                                 | | | | | | | | | |   		union all
                                 | | | | | | | | | |   	select UserId, 'Google', LastLoginTime from CK.tUserGoogle where UserId > 0
                                 | | | | | | | | | |   	;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   -- This has been transformed by []db^CK.DB.User.UserGoogle.Package([]db^CK.vUserAuthProvider), []db^CK.DB.User.UserOidc.Package([]db^CK.vUserAuthProvider), []db^CK.DB.User.UserPassword.Package([]db^CK.vUserAuthProvider)
   2018-05-30 16h09.35.0978768   | | | | | | | | | | GO
   2018-05-30 16h09.35.1015008 i | | | | | | | | | < 
   2018-05-30 16h09.35.1015008 i | | | | | | | | | > Installing []db^CK.UserGoogleTable.Head (= 2.0.1 =).
   2018-05-30 16h09.35.1015008 i | | | | | | | | | < 
   2018-05-30 16h09.35.1015008 i | | | | | | | | | > Installing []db^CK.UserOidcTable.Head (= 2.0.1 =).
   2018-05-30 16h09.35.1015008 i | | | | | | | | | < 
   2018-05-30 16h09.35.1015008 i | | | | | | | | | > Installing []db^CK.UserPasswordTable.Head (= 1.0.2 =).
   2018-05-30 16h09.35.1015008 i | | | | | | | | | < 
   2018-05-30 16h09.35.1015008 i | | | | | | | | | > Installing []db^CK.sUserGoogleDestroy (unversioned).
   2018-05-30 16h09.35.1029943   | | | | | | | | | | if OBJECT_ID('CK.sUserGoogleDestroy') is not null drop Procedure CK.sUserGoogleDestroy;
   2018-05-30 16h09.35.1029943   | | | | | | | | | | GO
   2018-05-30 16h09.35.1059878   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserGoogleDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId = 0 throw 50000, 'Argument.InvalidValue', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<PreDestroy revert /> 
                                 | | | | | | | | | |   	
                                 | | | | | | | | | |   	delete CK.tUserGoogle where UserId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PostDestroy /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1059878   | | | | | | | | | | GO
   2018-05-30 16h09.35.1104797 i | | | | | | | | | < 
   2018-05-30 16h09.35.1104797 i | | | | | | | | | > Installing []db^CK.sUserGoogleUCL (unversioned).
   2018-05-30 16h09.35.1104797   | | | | | | | | | | if OBJECT_ID('CK.sUserGoogleUCL') is not null drop Procedure CK.sUserGoogleUCL;
   2018-05-30 16h09.35.1104797   | | | | | | | | | | GO
   2018-05-30 16h09.35.1234575   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @GoogleAccountId can not be null. This is the key that identifies a Google user.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @Mode (flags): CreateOnly = 1, UpdateOnly = 2, CreateOrUpdate = 3, WithCheckLogin = 4, WithActualLogin = 8.
                                 | | | | | | | | | |   --                @Mode is normalized:
                                 | | | | | | | | | |   --                  - WithActualLogin implies WithCheckLogin.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @UCResult: None = 0, Created = 1, Updated = 2
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- When @UserId = 0 we are in "login mode": 
                                 | | | | | | | | | |   --  - @Mode must be UpdateOnly+WithCheckLogin (6) or UpdateOnly+WithActualLogin (10).
                                 | | | | | | | | | |   --    If the google id is found, we update what we have to and output the found @UserId.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- When @UserId is not 0, it must match with the one of the @GoogleAccountId otherwise it is an error
                                 | | | | | | | | | |   -- and an exception is thrown because:
                                 | | | | | | | | | |   --  - When updating it means that there is a mismatch of UserId/Google account in the calling code.
                                 | | | | | | | | | |   --  - When creating it means that another user with the same google account is already registered and
                                 | | | | | | | | | |   --    this should never happen.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- When extending this procedure, during update null parameters must be left unchanged.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserGoogleUCL
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int /*input*/output,
                                 | | | | | | | | | |   	@GoogleAccountId varchar(36), 
                                 | | | | | | | | | |   	@Mode int, -- not null enum { "CreateOnly" = 1, "UpdateOnly" = 2, "CreateOrUpdate" = 3, "WithCheckLogin" = 4, "WithActualLogin" = 8, "IgnoreOptimisticKey" = 16 }
                                 | | | | | | | | | |   	@UCResult int output, -- not null enum { None = 0, Created = 1, Updated = 2 }
                                 | | | | | | | | | |       @LoginFailureCode int output, -- Optional. Set by CK.sAuthUserOnLogin if login is rejected.
                                 | | | | | | | | | |       @LoginFailureReason nvarchar(255) output -- Optional.
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |   	-- Clears IgnoreOptimisticKey since we do not use it here.
                                 | | | | | | | | | |   	set @Mode = (@Mode&~16);
                                 | | | | | | | | | |       if @Mode is null or @Mode < 1 or @Mode > 15 throw 50000, 'Argument.InvalidMode', 1;
                                 | | | | | | | | | |   	-- Handles @Mode: extracts @CheckLogin & @ActualLogin bit for readability.
                                 | | | | | | | | | |   	declare @CheckLogin bit = 0;
                                 | | | | | | | | | |   	declare @ActualLogin bit = 0;
                                 | | | | | | | | | |   	if (@Mode&8) <> 0 
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		set @ActualLogin = 1;
                                 | | | | | | | | | |           set @CheckLogin = 1;
                                 | | | | | | | | | |   		set @Mode = @Mode&~(4+8);
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |       else if (@Mode&4) <> 0
                                 | | | | | | | | | |       begin
                                 | | | | | | | | | |           set @CheckLogin = 1;
                                 | | | | | | | | | |   		set @Mode = @Mode&~4;
                                 | | | | | | | | | |       end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |       if @ActorId is null or @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId is null or @UserId < 0 throw 50000, 'Argument.InvalidUserId', 1;
                                 | | | | | | | | | |   	if @GoogleAccountId is null throw 50000, 'Argument.NullGoogleAccountId', 1;
                                 | | | | | | | | | |   	if @UserId = 0 and (@Mode <> 2 or @CheckLogin = 0) throw 50000, 'Argument.ForUserIdZeroModeMustBeUpdateOnlyWithLogin', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   declare @ActualUserId int;
                                 | | | | | | | | | |   	declare @LastLoginTime datetime2(2);
                                 | | | | | | | | | |   	declare @Now datetime2(2) = sysutcdatetime();
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	select	@ActualUserId = UserId,
                                 | | | | | | | | | |               @LastLoginTime = LastLoginTime
                                 | | | | | | | | | |   		from CK.tUserGoogle 
                                 | | | | | | | | | |   		where GoogleAccountId = @GoogleAccountId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PreCreateOrUpdate revert /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	if @ActualUserId is null
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		if (@Mode&1) <> 0 -- CreateOnly or CreateOrUpdate
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |               set @LastLoginTime = '0001-01-01';
                                 | | | | | | | | | |   			--<PreCreate revert /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   			-- Unique constraint on GoogleAccountId will detect any existing UserId/GoogleAccountId clashes.
                                 | | | | | | | | | |   			insert into CK.tUserGoogle( UserId, GoogleAccountId, LastLoginTime ) 
                                 | | | | | | | | | |   				select	@UserId, 
                                 | | | | | | | | | |   						@GoogleAccountId, 
                                 | | | | | | | | | |   						@LastLoginTime;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   			set @UCResult = 1; -- Created
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   			--<PostCreate />
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   		else set @UCResult = 0; -- None
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	else
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		-- Updating an existing registration.
                                 | | | | | | | | | |   		if (@Mode&2) <> 0 -- UpdateOnly or CreateOrUpdate
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |   			-- When updating, we may be in "login mode" if @UserId is 0.
                                 | | | | | | | | | |   			-- But if we are not, the provided @UserId must match the actual one.
                                 | | | | | | | | | |   			if @UserId = 0 set @UserId = @ActualUserId;
                                 | | | | | | | | | |   			else if @UserId <> @ActualUserId throw 50000, 'Argument.UserIdAndGoogleIdMismatch', 1;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |               -- We have nothing to update since in case of login, LastLoginTime must be set
                                 | | | | | | | | | |               -- after having called CK.sAuthUserOnLogin.
                                 | | | | | | | | | |               -- This fake update is used as a placeholder for any actual updates that may be
                                 | | | | | | | | | |               -- injected by other packages.
                                 | | | | | | | | | |   			update CK.tUserGoogle set 
                                 | | | | | | | | | |   					LastLoginTime = LastLoginTime 
                                 | | | | | | | | | |   				where UserId = @ActualUserId and GoogleAccountId = @GoogleAccountId;
                                 | | | | | | | | | |   			set @UCResult = 2; -- Updated
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   		else set @UCResult = 0; -- None 
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |       --<PostCreateOrUpdate />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	if @CheckLogin = 1
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |           -- If the user is not registered and we did not create it @LastLoginTime is null.
                                 | | | | | | | | | |           if @LastLoginTime is null set @LoginFailureCode = 2; -- UnregisteredUser
                                 | | | | | | | | | |           else
                                 | | | | | | | | | |           begin
                                 | | | | | | | | | |   		    exec CK.sAuthUserOnLogin 'Google', @LastLoginTime, @UserId, @ActualLogin, @Now, @LoginFailureCode output, @LoginFailureReason output;  
                                 | | | | | | | | | |               if @ActualLogin = 1 and @LoginFailureCode is null
                                 | | | | | | | | | |               begin
                                 | | | | | | | | | |   			    update CK.tUserGoogle set LastLoginTime = @Now
                                 | | | | | | | | | |                       where UserId = @UserId and GoogleAccountId = @GoogleAccountId;
                                 | | | | | | | | | |               end
                                 | | | | | | | | | |           end
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |       else set @LoginFailureCode = 0; -- None
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1239559   | | | | | | | | | | GO
   2018-05-30 16h09.35.1279503 i | | | | | | | | | < 
   2018-05-30 16h09.35.1279503 i | | | | | | | | | > Installing []db^CK.sUserOidcDestroy (unversioned).
   2018-05-30 16h09.35.1279503   | | | | | | | | | | if OBJECT_ID('CK.sUserOidcDestroy') is not null drop Procedure CK.sUserOidcDestroy;
   2018-05-30 16h09.35.1279503   | | | | | | | | | | GO
   2018-05-30 16h09.35.1309508   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @SchemeSuffix: Scheme suffix to delete.
                                 | | | | | | | | | |   --                When null, all registrations for this provider regardless 
                                 | | | | | | | | | |   --                of the scheme suffix are deleted.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserOidcDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int,
                                 | | | | | | | | | |       @SchemeSuffix varchar(64)
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId = 0 throw 50000, 'Argument.InvalidValue', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<PreDestroy revert /> 
                                 | | | | | | | | | |   	
                                 | | | | | | | | | |       if @SchemeSuffix is null
                                 | | | | | | | | | |       begin
                                 | | | | | | | | | |   	    delete CK.tUserOidc where UserId = @UserId;
                                 | | | | | | | | | |       end
                                 | | | | | | | | | |       else
                                 | | | | | | | | | |       begin
                                 | | | | | | | | | |   	    delete CK.tUserOidc where UserId = @UserId and SchemeSuffix = @SchemeSuffix;
                                 | | | | | | | | | |       end
                                 | | | | | | | | | |   	--<PostDestroy /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1309508   | | | | | | | | | | GO
   2018-05-30 16h09.35.1329398 i | | | | | | | | | < 
   2018-05-30 16h09.35.1329398 i | | | | | | | | | > Installing []db^CK.sUserOidcUCL (unversioned).
   2018-05-30 16h09.35.1329398   | | | | | | | | | | if OBJECT_ID('CK.sUserOidcUCL') is not null drop Procedure CK.sUserOidcUCL;
   2018-05-30 16h09.35.1329398   | | | | | | | | | | GO
   2018-05-30 16h09.35.1374437   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @SchemeSuffix and @Sub (the "subject") can not be null. This is the key that identifies a Oidc user.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @Mode (flags): CreateOnly = 1, UpdateOnly = 2, CreateOrUpdate = 3, WithCheckLogin = 4, WithActualLogin = 8.
                                 | | | | | | | | | |   --                @Mode is normalized:
                                 | | | | | | | | | |   --                  - WithActualLogin implies WithCheckLogin.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @UCResult: None = 0, Created = 1, Updated = 2
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- When @UserId = 0 we are in "login mode": 
                                 | | | | | | | | | |   --  - @Mode must be UpdateOnly+WithCheckLogin (6) or UpdateOnly+WithActualLogin (10).
                                 | | | | | | | | | |   --    If the @SchemeSuffix/@Sub is found, we update what we have to and output the found @UserId.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- When @UserId is not 0, it must match with the one of the @SchemeSuffix/@Sub otherwise it is an error
                                 | | | | | | | | | |   -- and an exception is thrown because:
                                 | | | | | | | | | |   --  - When updating it means that there is a mismatch of UserId vs. @SchemeSuffix/@Sub account in the
                                 | | | | | | | | | |   --    calling code.
                                 | | | | | | | | | |   --  - When creating it means that another user with the same google account is already registered and
                                 | | | | | | | | | |   --    this should never happen.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- When extending this procedure, during update null parameters must be left unchanged.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserOidcUCL
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int /*input*/output,
                                 | | | | | | | | | |   	@SchemeSuffix varchar(64),
                                 | | | | | | | | | |       @Sub nvarchar(64),
                                 | | | | | | | | | |   	@Mode int, -- not null enum { "CreateOnly" = 1, "UpdateOnly" = 2, "CreateOrUpdate" = 3, "WithCheckLogin" = 4, "WithActualLogin" = 8, "IgnoreOptimisticKey" = 16 }
                                 | | | | | | | | | |   	@UCResult int output, -- not null enum { None = 0, Created = 1, Updated = 2 }
                                 | | | | | | | | | |       @LoginFailureCode int output, -- Optional. Set by CK.sAuthUserOnLogin if login is rejected.
                                 | | | | | | | | | |       @LoginFailureReason nvarchar(255) output -- Optional. Set by CK.sAuthUserOnLogin if login is rejected.
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |   	-- Clears IgnoreOptimisticKey since we do not use it here.
                                 | | | | | | | | | |   	set @Mode = (@Mode&~16);
                                 | | | | | | | | | |       if @Mode is null or @Mode < 1 or @Mode > 15 throw 50000, 'Argument.InvalidMode', 1;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	-- Handles @Mode: extracts @CheckLogin & @ActualLogin bit for readability.
                                 | | | | | | | | | |   	declare @CheckLogin bit = 0;
                                 | | | | | | | | | |   	declare @ActualLogin bit = 0;
                                 | | | | | | | | | |   	if (@Mode&8) <> 0 
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		set @ActualLogin = 1;
                                 | | | | | | | | | |           set @CheckLogin = 1;
                                 | | | | | | | | | |   		set @Mode = @Mode&~(4+8);
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |       else if (@Mode&4) <> 0
                                 | | | | | | | | | |       begin
                                 | | | | | | | | | |           set @CheckLogin = 1;
                                 | | | | | | | | | |   		set @Mode = @Mode&~4;
                                 | | | | | | | | | |       end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |       if @ActorId is null or @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId is null or @UserId < 0 throw 50000, 'Argument.InvalidUserId', 1;
                                 | | | | | | | | | |   	if @SchemeSuffix is null throw 50000, 'Argument.NullSchemeSuffix', 1;
                                 | | | | | | | | | |       set @SchemeSuffix = LTrim(RTrim(@SchemeSuffix));
                                 | | | | | | | | | |   	if @Sub is null throw 50000, 'Argument.NullSub', 1;
                                 | | | | | | | | | |   	if @UserId = 0 and (@Mode <> 2 or @CheckLogin = 0) throw 50000, 'Argument.ForUserIdZeroModeMustBeUpdateOnlyWithLogin', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   declare @ActualUserId int;
                                 | | | | | | | | | |   	declare @LastLoginTime datetime2(2);
                                 | | | | | | | | | |   	declare @Now datetime2(2) = sysutcdatetime();
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	select	@ActualUserId = UserId,
                                 | | | | | | | | | |               @LastLoginTime = LastLoginTime
                                 | | | | | | | | | |   		from CK.tUserOidc 
                                 | | | | | | | | | |   		where SchemeSuffix = @SchemeSuffix and Sub = @Sub;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PreCreateOrUpdate revert /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	if @ActualUserId is null
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		if (@Mode&1) <> 0 -- CreateOnly or CreateOrUpdate
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |               set @LastLoginTime = '0001-01-01';
                                 | | | | | | | | | |   			--<PreCreate revert /> 
                                 | | | | | | | | | |   			-- Unique constraint on SchemeSuffix/Sub will detect any existing UserId vs. SchemeSuffix/Sub clashes.
                                 | | | | | | | | | |   			insert into CK.tUserOidc( UserId, SchemeSuffix, Sub, LastLoginTime ) 
                                 | | | | | | | | | |   				select	@UserId, 
                                 | | | | | | | | | |   						@SchemeSuffix, 
                                 | | | | | | | | | |   						@Sub, 
                                 | | | | | | | | | |   						@LastLoginTime;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   			set @UCResult = 1; -- Created
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   			--<PostCreate />
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   		else set @UCResult = 0; -- None
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	else
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		-- Updating an existing registration.
                                 | | | | | | | | | |   		if (@Mode&2) <> 0 -- UpdateOnly or CreateOrUpdate
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |   			-- When updating, we may be in "login mode" if @UserId is 0.
                                 | | | | | | | | | |   			-- But if we are not, the provided @UserId must match the actual one.
                                 | | | | | | | | | |   			if @UserId = 0 set @UserId = @ActualUserId;
                                 | | | | | | | | | |   			else if @UserId <> @ActualUserId throw 50000, 'Argument.UserIdAndSchemeSuffixSubMismatch', 1;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   			--<PreUpdate revert /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |               -- We have nothing to update since in case of login, LastLoginTime must be set
                                 | | | | | | | | | |               -- after having called CK.sAuthUserOnLogin.
                                 | | | | | | | | | |               -- This fake update is used as a placeholder for any actual updates that may be
                                 | | | | | | | | | |               -- injected by other packages.
                                 | | | | | | | | | |   			update CK.tUserOidc set 
                                 | | | | | | | | | |   					LastLoginTime = LastLoginTime
                                 | | | | | | | | | |   				where UserId = @ActualUserId and SchemeSuffix = @SchemeSuffix and Sub = @Sub;
                                 | | | | | | | | | |   			--<PostUpdate />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   			set @UCResult = 2; -- Updated
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   		else set @UCResult = 0; -- None 
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PostCreateOrUpdate />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	if @CheckLogin = 1
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |           -- If the user is not registered and we did not create it @LastLoginTime is null.
                                 | | | | | | | | | |           if @LastLoginTime is null set @LoginFailureCode = 2; -- UnregisteredUser
                                 | | | | | | | | | |           else
                                 | | | | | | | | | |           begin
                                 | | | | | | | | | |               declare @SchemeFull varchar(64) = @SchemeSuffix;
                                 | | | | | | | | | |               if len(@SchemeFull) = 0 
                                 | | | | | | | | | |               begin
                                 | | | | | | | | | |                   set @SchemeFull = 'Oidc';
                                 | | | | | | | | | |               end
                                 | | | | | | | | | |               else
                                 | | | | | | | | | |               begin
                                 | | | | | | | | | |                   set @SchemeFull = 'Oidc.'+@SchemeFull;
                                 | | | | | | | | | |               end
                                 | | | | | | | | | |   		    exec CK.sAuthUserOnLogin @SchemeFull, @LastLoginTime, @UserId, @ActualLogin, @Now, @LoginFailureCode output, @LoginFailureReason output;  
                                 | | | | | | | | | |               if @ActualLogin = 1 and @LoginFailureCode is null
                                 | | | | | | | | | |               begin
                                 | | | | | | | | | |   			    update CK.tUserOidc set LastLoginTime = @Now
                                 | | | | | | | | | |                       where UserId = @UserId and SchemeSuffix = @SchemeSuffix and Sub = @Sub;
                                 | | | | | | | | | |               end
                                 | | | | | | | | | |   	    end
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |       else set @LoginFailureCode = 0; -- None
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1379301   | | | | | | | | | | GO
   2018-05-30 16h09.35.1429232 i | | | | | | | | | < 
   2018-05-30 16h09.35.1429232 i | | | | | | | | | > Installing []db^CK.sUserPasswordDestroy (unversioned).
   2018-05-30 16h09.35.1429232   | | | | | | | | | | if OBJECT_ID('CK.sUserPasswordDestroy') is not null drop Procedure CK.sUserPasswordDestroy;
   2018-05-30 16h09.35.1434221   | | | | | | | | | | GO
   2018-05-30 16h09.35.1454271   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserPasswordDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId = 0 throw 50000, 'Argument.InvalidValue', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   --<PreDestroy revert /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	delete CK.tUserPassword where UserId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	--<PostDestroy /> 
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1454271   | | | | | | | | | | GO
   2018-05-30 16h09.35.1474120 i | | | | | | | | | < 
   2018-05-30 16h09.35.1474120 i | | | | | | | | | > Installing []db^CK.sUserPasswordUCL (unversioned).
   2018-05-30 16h09.35.1479096   | | | | | | | | | | if OBJECT_ID('CK.sUserPasswordUCL') is not null drop Procedure CK.sUserPasswordUCL;
   2018-05-30 16h09.35.1479096   | | | | | | | | | | GO
   2018-05-30 16h09.35.1509048   | | | | | | | | | | -- SetupConfig: {}
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- @Mode: CreateOnly = 1, UpdateOnly = 2, CreateOrUpdate = 3, WithCheckLogin = 4, WithActualLogin = 8
                                 | | | | | | | | | |   -- @UCResult: None = 0, Created = 1, Updated = 2
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   create procedure CK.sUserPasswordUCL
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int /*input*/output, 
                                 | | | | | | | | | |   	@PwdHash varbinary(64),
                                 | | | | | | | | | |   	@Mode int, -- not null enum { "CreateOnly" = 1, "UpdateOnly" = 2, "CreateOrUpdate" = 3, "WithCheckLogin" = 4, "WithActualLogin" = 8, "IgnoreOptimisticKey" = 16 }
                                 | | | | | | | | | |   	@UCResult int output, -- not null enum { None = 0, Created = 1, Updated = 2 }
                                 | | | | | | | | | |       @LoginFailureCode int /*input*/output,
                                 | | | | | | | | | |       @LoginFailureReason nvarchar(255) output
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as
                                 | | | | | | | | | |   begin
                                 | | | | | | | | | |   	-- Clears IgnoreOptimisticKey since we do not use it here.
                                 | | | | | | | | | |   	set @Mode = (@Mode&~16);
                                 | | | | | | | | | |       if @Mode is null or @Mode < 1 or @Mode > 15 throw 50000, 'Argument.InvalidMode', 1;
                                 | | | | | | | | | |   	-- Handles @Mode: extracts @CheckLogin & @ActualLogin bit for readability.
                                 | | | | | | | | | |   	declare @CheckLogin bit = 0;
                                 | | | | | | | | | |   	declare @ActualLogin bit = 0;
                                 | | | | | | | | | |   	if (@Mode&8) <> 0 
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		set @ActualLogin = 1;
                                 | | | | | | | | | |           set @CheckLogin = 1;
                                 | | | | | | | | | |   		set @Mode = @Mode&~(4+8);
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |       else if (@Mode&4) <> 0
                                 | | | | | | | | | |       begin
                                 | | | | | | | | | |           set @CheckLogin = 1;
                                 | | | | | | | | | |   		set @Mode = @Mode&~4;
                                 | | | | | | | | | |       end
                                 | | | | | | | | | |   	if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId <= 0 throw 50000, 'Argument.InvalidUserId', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   declare @LastLoginTime datetime2(2);
                                 | | | | | | | | | |   	declare @Now datetime2(2) = sysutcdatetime();
                                 | | | | | | | | | |   	select @LastLoginTime = LastLoginTime from CK.tUserPassword where UserId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	if @LastLoginTime is null
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		if (@Mode&1) <> 0
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |   	        if @PwdHash is null or DataLength(@PwdHash) = 0 throw 50000, 'Argument.InvalidUserPwdHash', 1;
                                 | | | | | | | | | |   			set @LastLoginTime = '0001-01-01';
                                 | | | | | | | | | |   			--<PreCreate revert /> 
                                 | | | | | | | | | |   			insert into CK.tUserPassword( UserId, PwdHash, LastWriteTime, LastLoginTime )
                                 | | | | | | | | | |                   values( @UserId, @PwdHash, @Now, @LastLoginTime);
                                 | | | | | | | | | |   			set @UCResult = 1;
                                 | | | | | | | | | |   			--<PostCreate /> 
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   		else set @UCResult = 0;
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   	else
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		if (@Mode&2) <> 0
                                 | | | | | | | | | |   		begin
                                 | | | | | | | | | |   	        if @PwdHash is not null and DataLength(@PwdHash) = 0 throw 50000, 'Argument.InvalidUserPwdHash', 1;
                                 | | | | | | | | | |   			--<PreUpdate revert /> 
                                 | | | | | | | | | |   			update CK.tUserPassword set
                                 | | | | | | | | | |                   PwdHash = case when @PwdHash is null then PwdHash else @PwdHash end,
                                 | | | | | | | | | |                   LastWriteTime = case when @PwdHash is null then @Now else LastWriteTime end
                                 | | | | | | | | | |                 where UserId = @UserId;
                                 | | | | | | | | | |   			set @UCResult = 2;
                                 | | | | | | | | | |   			--<PostUpdate />
                                 | | | | | | | | | |   		end
                                 | | | | | | | | | |   		else set @UCResult = 0;
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   
                                 | | | | | | | | | |       if @CheckLogin = 1
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |           if @LastLoginTime is null set @LoginFailureCode = 2; -- UnregisteredUser
                                 | | | | | | | | | |           else
                                 | | | | | | | | | |           begin
                                 | | | | | | | | | |   		    exec CK.sAuthUserOnLogin 'Basic', @LastLoginTime, @UserId, @ActualLogin, @Now, @LoginFailureCode output, @LoginFailureReason output;
                                 | | | | | | | | | |               if @ActualLogin = 1 and @LoginFailureCode is null
                                 | | | | | | | | | |               begin
                                 | | | | | | | | | |   			    update CK.tUserPassword set LastLoginTime = @Now where UserId = @UserId;
                                 | | | | | | | | | |               end
                                 | | | | | | | | | |           end
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |       else set @LoginFailureCode = 0; -- None
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1509048   | | | | | | | | | | GO
   2018-05-30 16h09.35.1540937 i | | | | | | | | | < 
   2018-05-30 16h09.35.1540937 i | | | | | | | | | > Installing []db^CK.UserGoogleTable([]db^CK.sUserDestroy) (unversioned).
   2018-05-30 16h09.35.1906003   | | | | | | | | | | Successfully applied 'inject "
                                 | | | | | | | | | |   		exec CK.sUserGoogleDestroy @ActorId, @UserId;
                                 | | | | | | | | | |   	" into "PreDestroy";'.
   2018-05-30 16h09.35.1906003   | | | | | | | | | | > Parsing transformation result.
   2018-05-30 16h09.35.1915985   | | | | | | | | | | < 
   2018-05-30 16h09.35.1925968   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sUserRemoveFromAllGroups" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Destroys a User: automatically removes it from any Groups it may belong to.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   alter procedure CK.sUserDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId <= 1 throw 50000, 'User.Undestroyable', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   if exists( select * from CK.tUser where UserId = @UserId )
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		--<PreDestroy revert >
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserGoogleDestroy @ActorId, @UserId;
                                 | | | | | | | | | |   --</PreDestroy>
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserRemoveFromAllGroups @ActorId, @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		delete from CK.tActorProfile where ActorId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tUser where UserId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tActor where ActorId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PostDestroy />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1925968   | | | | | | | | | | GO
   2018-05-30 16h09.35.1960936 i | | | | | | | | | < 
   2018-05-30 16h09.35.1960936 i | | | | | | | | | > Installing []db^CK.UserOidcTable([]db^CK.sUserDestroy) (unversioned).
   2018-05-30 16h09.35.1976055   | | | | | | | | | | Successfully applied 'inject "
                                 | | | | | | | | | |   		exec CK.sUserOidcDestroy @ActorId, @UserId, null;
                                 | | | | | | | | | |   	" into "PreDestroy";'.
   2018-05-30 16h09.35.1976055   | | | | | | | | | | > Parsing transformation result.
   2018-05-30 16h09.35.1986010   | | | | | | | | | | < 
   2018-05-30 16h09.35.1990861   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sUserRemoveFromAllGroups" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Destroys a User: automatically removes it from any Groups it may belong to.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   alter procedure CK.sUserDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId <= 1 throw 50000, 'User.Undestroyable', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   if exists( select * from CK.tUser where UserId = @UserId )
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		--<PreDestroy revert >
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserOidcDestroy @ActorId, @UserId, null;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserGoogleDestroy @ActorId, @UserId;
                                 | | | | | | | | | |   --</PreDestroy>
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserRemoveFromAllGroups @ActorId, @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		delete from CK.tActorProfile where ActorId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tUser where UserId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tActor where ActorId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PostDestroy />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
   2018-05-30 16h09.35.1995832   | | | | | | | | | | GO
   2018-05-30 16h09.35.2280752 i | | | | | | | | | < 
   2018-05-30 16h09.35.2280752 i | | | | | | | | | > Installing []db^CK.UserPasswordTable([]db^CK.sUserDestroy) (unversioned).
   2018-05-30 16h09.35.2285880   | | | | | | | | | | Successfully applied 'inject "
                                 | | | | | | | | | |   		exec CK.sUserPasswordDestroy @ActorId, @UserId;
                                 | | | | | | | | | |   	" into "PreDestroy";'.
   2018-05-30 16h09.35.2285880   | | | | | | | | | | > Parsing transformation result.
   2018-05-30 16h09.35.2295849   | | | | | | | | | | < 
   2018-05-30 16h09.35.2305680   | | | | | | | | | | -- SetupConfig: { "Requires": [ "CK.sUserRemoveFromAllGroups" ] }
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   -- Destroys a User: automatically removes it from any Groups it may belong to.
                                 | | | | | | | | | |   --
                                 | | | | | | | | | |   alter procedure CK.sUserDestroy
                                 | | | | | | | | | |   (
                                 | | | | | | | | | |   	@ActorId int,
                                 | | | | | | | | | |   	@UserId int
                                 | | | | | | | | | |   )
                                 | | | | | | | | | |   as begin
                                 | | | | | | | | | |       if @ActorId <= 0 throw 50000, 'Security.AnonymousNotAllowed', 1;
                                 | | | | | | | | | |       if @UserId <= 1 throw 50000, 'User.Undestroyable', 1;
                                 | | | | | | | | | |   --[=beginsp]
                                 | | | | | | | | | |   set nocount on; declare @SPCallTC int = @@TRANCOUNT, @SPCallId sysname; 
                                 | | | | | | | | | |   beginsp: if @SPCallTC = 0 begin tran; else begin set @SPCallId = cast(32*cast(@@PROCID as bigint)+@@NESTLEVEL as varchar); save transaction @SPCallId; end begin try
                                 | | | | | | | | | |   --[=/beginsp]
                                 | | | | | | | | | |   if exists( select * from CK.tUser where UserId = @UserId )
                                 | | | | | | | | | |   	begin
                                 | | | | | | | | | |   		--<PreDestroy revert >
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserPasswordDestroy @ActorId, @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserOidcDestroy @ActorId, @UserId, null;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserGoogleDestroy @ActorId, @UserId;
                                 | | | | | | | | | |   --</PreDestroy>
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		exec CK.sUserRemoveFromAllGroups @ActorId, @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		delete from CK.tActorProfile where ActorId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tUser where UserId = @UserId;
                                 | | | | | | | | | |   		delete from CK.tActor where ActorId = @UserId;
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   		--<PostDestroy />
                                 | | | | | | | | | |   
                                 | | | | | | | | | |   	end
                                 | | | | | | | | | |   --[=endsp]
                                 | | | | | | | | | |   end try
                                 | | | | | | | | | |   begin catch if @SPCallTC = 0 rollback; else if XACT_STATE() = 1 rollback transaction @SPCallId; exec CKCore.sErrorRethrow @@ProcId; return -1; end catch;
                                 | | | | | | | | | |   endsp: if @SPCallTC = 0 commit; return 0;
                                 | | | | | | | | | |   --[=/endsp]
                                 | | | | | | | | | |   end
                                 | | | | | | | | | |   -- This has been transformed by []db^CK.UserGoogleTable([]db^CK.sUserDestroy), []db^CK.UserOidcTable([]db^CK.sUserDestroy), []db^CK.UserPasswordTable([]db^CK.sUserDestroy)
   2018-05-30 16h09.35.2305680   | | | | | | | | | | GO
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.vUserAuthProvider#transform (unversioned).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.sUserDestroy#transform (unversioned).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.UserGoogleTable (= 2.0.1 =).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.UserOidcTable (= 2.0.1 =).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.UserPasswordTable (= 1.0.2 =).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.DB.User.UserGoogle.Package (= 1.0.0 =).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.DB.User.UserOidc.Package (= 1.0.0 =).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^CK.DB.User.UserPassword.Package (= 1.0.1 =).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | | > Installing []db^SqlDatabase (unversioned).
   2018-05-30 16h09.35.2330643 i | | | | | | | | | < 
   2018-05-30 16h09.35.2330643 i | | | | | | | | < 
   2018-05-30 16h09.35.2335614 i | | | | | | | | > Settle step.
   2018-05-30 16h09.35.2345592   | | | | | | | | | > Raising Settle setup event.
   2018-05-30 16h09.35.2345592   | | | | | | | | | < 
   2018-05-30 16h09.35.2345592 i | | | | | | | | | > Settling []CK._g.poco.Factory.
   2018-05-30 16h09.35.2360564 i | | | | | | | | | < 
   2018-05-30 16h09.35.2360564 i | | | | | | | | | > Settling []db^SqlDatabase.Connection.
   2018-05-30 16h09.35.2360564 i | | | | | | | | | < 
   2018-05-30 16h09.35.2360564 i | | | | | | | | | > Settling []db^Model.SqlDatabase.Head.
   2018-05-30 16h09.35.2365557 i | | | | | | | | | < 
   2018-05-30 16h09.35.2365557 i | | | | | | | | | > Settling []db^Model.CK.DB.Actor.Package.Head.
   2018-05-30 16h09.35.2365557 i | | | | | | | | | < 
   2018-05-30 16h09.35.2365557 i | | | | | | | | | > Settling []db^Model.CK.ActorTable.Head.
   2018-05-30 16h09.35.2365557 i | | | | | | | | | < 
   2018-05-30 16h09.35.2365557 i | | | | | | | | | > Settling []db^Model.CK.ActorTable.
   2018-05-30 16h09.35.2375535 i | | | | | | | | | < 
   2018-05-30 16h09.35.2375535 i | | | | | | | | | > Settling []db^Model.CK.GroupTable.Head.
   2018-05-30 16h09.35.2375535 i | | | | | | | | | < 
   2018-05-30 16h09.35.2375535 i | | | | | | | | | > Settling []db^Model.CK.UserTable.Head.
   2018-05-30 16h09.35.2375535 i | | | | | | | | | < 
   2018-05-30 16h09.35.2375535 i | | | | | | | | | > Settling []db^Model.CK.GroupTable.
   2018-05-30 16h09.35.2375535 i | | | | | | | | | < 
   2018-05-30 16h09.35.2375535 i | | | | | | | | | > Settling []db^Model.CK.UserTable.
   2018-05-30 16h09.35.2375535 i | | | | | | | | | < 
   2018-05-30 16h09.35.2375535 i | | | | | | | | | > Settling []db^Model.CK.ActorProfileTable.Head.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.ActorProfileTable.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.DB.Actor.Package.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.DB.Auth.Package.Head.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.AuthProviderTable.Head.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.AuthProviderTable.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.DB.Auth.Package.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.DB.User.UserGoogle.Package.Head.
   2018-05-30 16h09.35.2380529 i | | | | | | | | | < 
   2018-05-30 16h09.35.2380529 i | | | | | | | | | > Settling []db^Model.CK.DB.User.UserOidc.Package.Head.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.DB.User.UserPassword.Package.Head.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.UserGoogleTable.Head.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.UserOidcTable.Head.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.UserPasswordTable.Head.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.UserGoogleTable.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.UserOidcTable.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.UserPasswordTable.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.DB.User.UserGoogle.Package.
   2018-05-30 16h09.35.2385522 i | | | | | | | | | < 
   2018-05-30 16h09.35.2385522 i | | | | | | | | | > Settling []db^Model.CK.DB.User.UserOidc.Package.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^Model.CK.DB.User.UserPassword.Package.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^Model.SqlDatabase.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^SqlDatabase.Head.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^CK.DB.Actor.Package.Head.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^CK.ActorTable.Head.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^CK.sActorCreate.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^CK.ActorTable.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2390511 i | | | | | | | | | > Settling []db^CK.GroupTable.Head.
   2018-05-30 16h09.35.2390511 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.UserTable.Head.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.sGroupCreate.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.sGroupUserAdd.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.sGroupUserRemove.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.sUserCreate.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.sUserUserNameSet.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.vGroup.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.vUser.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.sGroupRemoveAllUsers.
   2018-05-30 16h09.35.2395500 i | | | | | | | | | < 
   2018-05-30 16h09.35.2395500 i | | | | | | | | | > Settling []db^CK.sUserRemoveFromAllGroups.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.sGroupDestroy.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.sUserDestroy.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.GroupTable.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.UserTable.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.ActorProfileTable.Head.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.ActorProfileTable.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.DB.Actor.Package.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2400494 i | | | | | | | | | > Settling []db^CK.DB.Auth.Package.Head.
   2018-05-30 16h09.35.2400494 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.AuthProviderTable.Head.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.sAuthUserOnLogin.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.vUserAuthProvider.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.sAuthProviderRegister.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.sAuthUserInfoRead.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.AuthProviderTable.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.DB.Auth.Package.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.DB.User.UserGoogle.Package.Head.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2405483 i | | | | | | | | | > Settling []db^CK.DB.User.UserOidc.Package.Head.
   2018-05-30 16h09.35.2405483 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.DB.User.UserPassword.Package.Head.
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.DB.User.UserGoogle.Package([]db^CK.vUserAuthProvider).
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.DB.User.UserOidc.Package([]db^CK.vUserAuthProvider).
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.DB.User.UserPassword.Package([]db^CK.vUserAuthProvider).
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.UserGoogleTable.Head.
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.UserOidcTable.Head.
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.UserPasswordTable.Head.
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.sUserGoogleDestroy.
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2410472 i | | | | | | | | | > Settling []db^CK.sUserGoogleUCL.
   2018-05-30 16h09.35.2410472 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.sUserOidcDestroy.
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.sUserOidcUCL.
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.sUserPasswordDestroy.
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.sUserPasswordUCL.
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.UserGoogleTable([]db^CK.sUserDestroy).
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.UserOidcTable([]db^CK.sUserDestroy).
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.UserPasswordTable([]db^CK.sUserDestroy).
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.vUserAuthProvider#transform.
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.sUserDestroy#transform.
   2018-05-30 16h09.35.2415465 i | | | | | | | | | < 
   2018-05-30 16h09.35.2415465 i | | | | | | | | | > Settling []db^CK.UserGoogleTable.
   2018-05-30 16h09.35.2420454 i | | | | | | | | | < 
   2018-05-30 16h09.35.2420454 i | | | | | | | | | > Settling []db^CK.UserOidcTable.
   2018-05-30 16h09.35.2420454 i | | | | | | | | | < 
   2018-05-30 16h09.35.2420454 i | | | | | | | | | > Settling []db^CK.UserPasswordTable.
   2018-05-30 16h09.35.2420454 i | | | | | | | | | < 
   2018-05-30 16h09.35.2420454 i | | | | | | | | | > Settling []db^CK.DB.User.UserGoogle.Package.
   2018-05-30 16h09.35.2420454 i | | | | | | | | | < 
   2018-05-30 16h09.35.2420454 i | | | | | | | | | > Settling []db^CK.DB.User.UserOidc.Package.
   2018-05-30 16h09.35.2420454 i | | | | | | | | | < 
   2018-05-30 16h09.35.2420454 i | | | | | | | | | > Settling []db^CK.DB.User.UserPassword.Package.
   2018-05-30 16h09.35.2420454 i | | | | | | | | | < 
   2018-05-30 16h09.35.2420454 i | | | | | | | | | > Settling []db^SqlDatabase.
   2018-05-30 16h09.35.2420454 i | | | | | | | | | < 
   2018-05-30 16h09.35.2420454   | | | | | | | | | > Raising Success setup event.
   2018-05-30 16h09.35.2420454   | | | | | | | | | < 
   2018-05-30 16h09.35.2420454 i | | | | | | | | < 
   2018-05-30 16h09.35.2430433 i | | | | | | | | > Disposing 88 drivers.
   2018-05-30 16h09.35.2430433 i | | | | | | | | < 
   2018-05-30 16h09.35.2430433   | | | | | | | | > Raising Disposed setup event.
   2018-05-30 16h09.35.2435426   | | | | | | | | < 
   2018-05-30 16h09.35.2460376 i | | | | | | | < 
   2018-05-30 16h09.35.2465369 i | | | | | | | > Aspect: CK.SqlServer.Setup.SqlSetupAspect.
   2018-05-30 16h09.35.2465369 i | | | | | | | < 
   2018-05-30 16h09.35.2465369 i | | | | | | | > Executing initial 0 deferred actions.
   2018-05-30 16h09.35.2465369 i | | | | | | | <  | 1 conclusion:
                                 | | | | | | |    | Executed 0 actions.
   2018-05-30 16h09.35.2465369 i | | | | | | < 
   2018-05-30 16h09.35.2480341 i | | | | | | > Generating AppContext assembly (first run).
   2018-05-30 16h09.35.2490323 i | | | | | | | > Generating StObj dynamic assembly.
   2018-05-30 16h09.35.3207331 i | | | | | | | | > Generating source code.
   2018-05-30 16h09.35.3790032 i | | | | | | | | | > Generating Method GroupTable.CreateGroupAsync( ISqlCallContext ctx, Int32 actorId ) => Task`1.
   2018-05-30 16h09.35.3839958   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sGroupCreate(@ActorId int, @GroupIdResult int output)'.
   2018-05-30 16h09.35.3979674   | | | | | | | | | | < 
   2018-05-30 16h09.35.4393925 i | | | | | | | | | < 
   2018-05-30 16h09.35.4393925 i | | | | | | | | | > Generating Method GroupTable.DestroyGroupAsync( ISqlCallContext ctx, Int32 actorId, Int32 groupId, Boolean forceDestroy = False ) => Task.
   2018-05-30 16h09.35.4398892   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sGroupDestroy(@ActorId int, @GroupId int, @ForceDestroy bit=0)'.
   2018-05-30 16h09.35.4398892   | | | | | | | | | | < 
   2018-05-30 16h09.35.4404073 i | | | | | | | | | < 
   2018-05-30 16h09.35.4404073 i | | | | | | | | | > Generating Method GroupTable.AddUserAsync( ISqlCallContext ctx, Int32 actorId, Int32 groupId, Int32 userId ) => Task.
   2018-05-30 16h09.35.4404073   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sGroupUserAdd(@ActorId int, @GroupId int, @UserId int)'.
   2018-05-30 16h09.35.4404073   | | | | | | | | | | < 
   2018-05-30 16h09.35.4404073 i | | | | | | | | | < 
   2018-05-30 16h09.35.4404073 i | | | | | | | | | > Generating Method GroupTable.RemoveUserAsync( ISqlCallContext ctx, Int32 actorId, Int32 groupId, Int32 userId ) => Task.
   2018-05-30 16h09.35.4404073   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sGroupUserRemove(@ActorId int, @GroupId int, @UserId int)'.
   2018-05-30 16h09.35.4408874   | | | | | | | | | | < 
   2018-05-30 16h09.35.4408874 i | | | | | | | | | < 
   2018-05-30 16h09.35.4408874 i | | | | | | | | | > Generating Method GroupTable.RemoveAllUsersAsync( ISqlCallContext ctx, Int32 actorId, Int32 groupId ) => Task.
   2018-05-30 16h09.35.4408874   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sGroupRemoveAllUsers(@ActorId int, @GroupId int)'.
   2018-05-30 16h09.35.4408874   | | | | | | | | | | < 
   2018-05-30 16h09.35.4408874 i | | | | | | | | | < 
   2018-05-30 16h09.35.4408874 i | | | | | | | | | > Generating Method GroupTable.CreateGroup( ISqlCallContext ctx, Int32 actorId ) => Int32.
   2018-05-30 16h09.35.4419049 i | | | | | | | | | < 
   2018-05-30 16h09.35.4419049 i | | | | | | | | | > Generating Method GroupTable.DestroyGroup( ISqlCallContext ctx, Int32 actorId, Int32 groupId, Boolean forceDestroy = False ).
   2018-05-30 16h09.35.4419049 i | | | | | | | | | < 
   2018-05-30 16h09.35.4419049 i | | | | | | | | | > Generating Method GroupTable.AddUser( ISqlCallContext ctx, Int32 actorId, Int32 groupId, Int32 userId ).
   2018-05-30 16h09.35.4419049 i | | | | | | | | | < 
   2018-05-30 16h09.35.4419049 i | | | | | | | | | > Generating Method GroupTable.RemoveUser( ISqlCallContext ctx, Int32 actorId, Int32 groupId, Int32 userId ).
   2018-05-30 16h09.35.4419049 i | | | | | | | | | < 
   2018-05-30 16h09.35.4419049 i | | | | | | | | | > Generating Method GroupTable.RemoveAllUsers( ISqlCallContext ctx, Int32 actorId, Int32 groupId ).
   2018-05-30 16h09.35.4419049 i | | | | | | | | | < 
   2018-05-30 16h09.35.4423846 i | | | | | | | | | > Generating Method UserTable.CreateUserAsync( ISqlCallContext ctx, Int32 actorId, String userName ) => Task`1.
   2018-05-30 16h09.35.4423846   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserCreate(@ActorId int, @UserName nvarchar(255), @UserIdResult int output)'.
   2018-05-30 16h09.35.4429022   | | | | | | | | | | < 
   2018-05-30 16h09.35.4429022 i | | | | | | | | | < 
   2018-05-30 16h09.35.4429022 i | | | | | | | | | > Generating Method UserTable.UserNameSetAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId, String userName ) => Task`1.
   2018-05-30 16h09.35.4429022   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserUserNameSet(@ActorId int, @UserId int, @UserName nvarchar(127), @Done bit output)'.
   2018-05-30 16h09.35.4433824   | | | | | | | | | | < 
   2018-05-30 16h09.35.4433824 i | | | | | | | | | < 
   2018-05-30 16h09.35.4433824 i | | | | | | | | | > Generating Method UserTable.DestroyUserAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId ) => Task.
   2018-05-30 16h09.35.4433824   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserDestroy(@ActorId int, @UserId int)'.
   2018-05-30 16h09.35.4433824   | | | | | | | | | | < 
   2018-05-30 16h09.35.4433824 i | | | | | | | | | < 
   2018-05-30 16h09.35.4433824 i | | | | | | | | | > Generating Method UserTable.RemoveFromAllGroupsAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId ) => Task.
   2018-05-30 16h09.35.4433824   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserRemoveFromAllGroups(@ActorId int, @UserId int)'.
   2018-05-30 16h09.35.4438817   | | | | | | | | | | < 
   2018-05-30 16h09.35.4438817 i | | | | | | | | | < 
   2018-05-30 16h09.35.4438817 i | | | | | | | | | > Generating Method UserTable.CreateUser( ISqlCallContext ctx, Int32 actorId, String userName ) => Int32.
   2018-05-30 16h09.35.4438817 i | | | | | | | | | < 
   2018-05-30 16h09.35.4438817 i | | | | | | | | | > Generating Method UserTable.UserNameSet( ISqlCallContext ctx, Int32 actorId, Int32 userId, String userName ) => Boolean.
   2018-05-30 16h09.35.4438817 i | | | | | | | | | < 
   2018-05-30 16h09.35.4438817 i | | | | | | | | | > Generating Method UserTable.DestroyUser( ISqlCallContext ctx, Int32 actorId, Int32 userId ).
   2018-05-30 16h09.35.4438817 i | | | | | | | | | < 
   2018-05-30 16h09.35.4438817 i | | | | | | | | | > Generating Method UserTable.RemoveFromAllGroups( ISqlCallContext ctx, Int32 actorId, Int32 userId ).
   2018-05-30 16h09.35.4443802 i | | | | | | | | | < 
   2018-05-30 16h09.35.4443802 i | | | | | | | | | > Generating Method Package.CmdReadUserAuthInfo( Int32 actorId, Int32 userId ) => SqlCommand.
   2018-05-30 16h09.35.4443802   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sAuthUserInfoRead(@ActorId int, @UserId int)'.
   2018-05-30 16h09.35.4443802   | | | | | | | | | | < 
   2018-05-30 16h09.35.4443802 i | | | | | | | | | < 
   2018-05-30 16h09.35.4443802 i | | | | | | | | | > Generating Method Package.OnUserLoginAsync( ISqlCallContext ctx, String scheme, DateTime lastLoginTime, Int32 userId, Boolean actualLogin, DateTime loginTimeNow ) => Task`1.
   2018-05-30 16h09.35.4443802   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sAuthUserOnLogin(@Scheme varchar(64), @LastLoginTime datetime2(2), @UserId int, @ActualLogin bit, @LoginTimeNow datetime2(2), @FailureCode int output, @FailureReason nvarchar(255) output)'.
   2018-05-30 16h09.35.4448813   | | | | | | | | | | < 
   2018-05-30 16h09.35.4573602 i | | | | | | | | | < 
   2018-05-30 16h09.35.4573602 i | | | | | | | | | > Generating Method Package.OnUserLogin( ISqlCallContext ctx, String scheme, DateTime lastLoginTime, Int32 userId, Boolean actualLogin, DateTime loginTimeNow ) => LoginResult.
   2018-05-30 16h09.35.4573602 i | | | | | | | | | < 
   2018-05-30 16h09.35.4573602 i | | | | | | | | | > Generating Method AuthProviderTable.RegisterProviderAsync( ISqlCallContext ctx, Int32 actorId, String providerName, String userProviderSchemaTableName, Boolean isMultiScheme ) => Task`1.
   2018-05-30 16h09.35.4578555   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sAuthProviderRegister(@ActorId int, @ProviderName varchar(64), @UserProviderSchemaTableName nvarchar(128), @IsMultiScheme bit, @AuthProviderIdResult int output)'.
   2018-05-30 16h09.35.4578555   | | | | | | | | | | < 
   2018-05-30 16h09.35.4578555 i | | | | | | | | | < 
   2018-05-30 16h09.35.4578555 i | | | | | | | | | > Generating Method AuthProviderTable.RegisterProvider( ISqlCallContext ctx, Int32 actorId, String providerName, String userProviderSchemaTableName, Boolean isMultiScheme ) => Int32.
   2018-05-30 16h09.35.4578555 i | | | | | | | | | < 
   2018-05-30 16h09.35.4583576 i | | | | | | | | | > Generating Method UserGoogleTable.DestroyGoogleUserAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId, CancellationToken cancellationToken = null ) => Task.
   2018-05-30 16h09.35.4583576   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserGoogleDestroy(@ActorId int, @UserId int)'.
   2018-05-30 16h09.35.4583576   | | | | | | | | | | < 
   2018-05-30 16h09.35.4583576 i | | | | | | | | | < 
   2018-05-30 16h09.35.4583576 i | | | | | | | | | > Generating Method UserGoogleTable.GoogleUserUCLAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId, IUserGoogleInfo info, UCLMode mode, CancellationToken cancellationToken ) => Task`1.
   2018-05-30 16h09.35.4588556   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserGoogleUCL(@ActorId int, @UserId int /*input*/output, @GoogleAccountId varchar(36), @Mode int, @UCResult int output, @LoginFailureCode int output, @LoginFailureReason nvarchar(255) output)'.
   2018-05-30 16h09.35.4588556   | | | | | | | | | | < 
   2018-05-30 16h09.35.4618878 i | | | | | | | | | | Sql Parameter '@GoogleAccountId varchar(36)' will take its value from the [ParameterSource] 'info.GoogleAccountId' property.
   2018-05-30 16h09.35.4628870 i | | | | | | | | | < 
   2018-05-30 16h09.35.4628870 i | | | | | | | | | > Generating Method UserGoogleTable.DestroyGoogleUser( ISqlCallContext ctx, Int32 actorId, Int32 userId ).
   2018-05-30 16h09.35.4628870 i | | | | | | | | | < 
   2018-05-30 16h09.35.4628870 i | | | | | | | | | > Generating Method UserGoogleTable.UserGoogleUCL( ISqlCallContext ctx, Int32 actorId, Int32 userId, IUserGoogleInfo info, UCLMode mode ) => UCLResult.
   2018-05-30 16h09.35.4628870 i | | | | | | | | | | Sql Parameter '@GoogleAccountId varchar(36)' will take its value from the [ParameterSource] 'info.GoogleAccountId' property.
   2018-05-30 16h09.35.4633944 i | | | | | | | | | < 
   2018-05-30 16h09.35.4633944 i | | | | | | | | | > Generating Method UserOidcTable.DestroyOidcUserAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId, String schemeSuffix, CancellationToken cancellationToken = null ) => Task.
   2018-05-30 16h09.35.4633944   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserOidcDestroy(@ActorId int, @UserId int, @SchemeSuffix varchar(64))'.
   2018-05-30 16h09.35.4633944   | | | | | | | | | | < 
   2018-05-30 16h09.35.4633944 i | | | | | | | | | < 
   2018-05-30 16h09.35.4638830 i | | | | | | | | | > Generating Method UserOidcTable.UserOidcULC( ISqlCallContext ctx, Int32 actorId, Int32 userId, IUserOidcInfo info, UCLMode mode, CancellationToken cancellationToken ) => Task`1.
   2018-05-30 16h09.35.4638830   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserOidcUCL(@ActorId int, @UserId int /*input*/output, @SchemeSuffix varchar(64), @Sub nvarchar(64), @Mode int, @UCResult int output, @LoginFailureCode int output, @LoginFailureReason nvarchar(255) output)'.
   2018-05-30 16h09.35.4638830   | | | | | | | | | | < 
   2018-05-30 16h09.35.4644006 i | | | | | | | | | | Sql Parameter '@SchemeSuffix varchar(64)' will take its value from the [ParameterSource] 'info.SchemeSuffix' property.
   2018-05-30 16h09.35.4644006 i | | | | | | | | | | Sql Parameter '@Sub nvarchar(64)' will take its value from the [ParameterSource] 'info.Sub' property.
   2018-05-30 16h09.35.4644006 i | | | | | | | | | < 
   2018-05-30 16h09.35.4644006 i | | | | | | | | | > Generating Method UserOidcTable.DestroyOidcUser( ISqlCallContext ctx, Int32 actorId, Int32 userId, String schemeSuffix ).
   2018-05-30 16h09.35.4644006 i | | | | | | | | | < 
   2018-05-30 16h09.35.4644006 i | | | | | | | | | > Generating Method UserOidcTable.UserOidcUCL( ISqlCallContext ctx, Int32 actorId, Int32 userId, IUserOidcInfo info, UCLMode mode ) => UCLResult.
   2018-05-30 16h09.35.4648813 i | | | | | | | | | | Sql Parameter '@SchemeSuffix varchar(64)' will take its value from the [ParameterSource] 'info.SchemeSuffix' property.
   2018-05-30 16h09.35.4648813 i | | | | | | | | | | Sql Parameter '@Sub nvarchar(64)' will take its value from the [ParameterSource] 'info.Sub' property.
   2018-05-30 16h09.35.4648813 i | | | | | | | | | < 
   2018-05-30 16h09.35.4648813 i | | | | | | | | | > Generating Method UserPasswordTable.DestroyPasswordUserAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId, CancellationToken cancellationToken = null ) => Task.
   2018-05-30 16h09.35.4648813   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserPasswordDestroy(@ActorId int, @UserId int)'.
   2018-05-30 16h09.35.4648813   | | | | | | | | | | < 
   2018-05-30 16h09.35.4653802 i | | | | | | | | | < 
   2018-05-30 16h09.35.4653802 i | | | | | | | | | > Generating Method UserPasswordTable.PasswordUserUCLAsync( ISqlCallContext ctx, Int32 actorId, Int32 userId, Byte[] pwdHash, UCLMode mode, Nullable`1 loginFailureCode = null, CancellationToken cancellationToken = null ) => Task`1.
   2018-05-30 16h09.35.4653802   | | | | | | | | | | > Low level SqlCommand create method for: 'procedure CK.sUserPasswordUCL(@ActorId int, @UserId int /*input*/output, @PwdHash varbinary(64), @Mode int, @UCResult int output, @LoginFailureCode int /*input*/output, @LoginFailureReason nvarchar(255) output)'.
   2018-05-30 16h09.35.4653802   | | | | | | | | | | < 
   2018-05-30 16h09.35.4658987 i | | | | | | | | | < 
   2018-05-30 16h09.35.4658987 i | | | | | | | | | > Generating Method UserPasswordTable.DestroyPasswordUser( ISqlCallContext ctx, Int32 actorId, Int32 userId ).
   2018-05-30 16h09.35.4658987 i | | | | | | | | | < 
   2018-05-30 16h09.35.4658987 i | | | | | | | | | > Generating Method UserPasswordTable.PasswordUserUCL( ISqlCallContext ctx, Int32 actorId, Int32 userId, Byte[] pwdHash, UCLMode mode, Nullable`1 loginFailureCode ) => UCLResult.
   2018-05-30 16h09.35.4658987 i | | | | | | | | | < 
   2018-05-30 16h09.35.4807547 i | | | | | | | | < 
   2018-05-30 16h09.35.4807547 i | | | | | | | | > Compiling source code.
   2018-05-30 16h09.41.1558613 i | | | | | | | | | Saved source file: C:\Users\olivi\AppData\Local\Temp\CKSetup2018-05-30 16h09.29.5323034\CK.StObj.AutoAssembly.dll.0.cs
   2018-05-30 16h09.41.1593549 i | | | | | | | | | Saved source file: C:\Users\olivi\AppData\Local\Temp\CKSetup2018-05-30 16h09.29.5323034\CK.StObj.AutoAssembly.dll.1.cs
   2018-05-30 16h09.41.1628464 i | | | | | | | | | > Code Generation information.
   2018-05-30 16h09.41.1633453 W | | | | | | | | | | > 1 assembly load conflict(s).
   2018-05-30 16h09.41.1643583 W | | | | | | | | | | | Sucess: 'System.Collections.Immutable, Version=1.2.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' => 'System.Collections.Immutable, Version=1.2.1.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' (no requesting assembly)
   2018-05-30 16h09.41.1643583 W | | | | | | | | | | < 
   2018-05-30 16h09.41.1643583 i | | | | | | | | | | Source code generation and compilation succeeded.
   2018-05-30 16h09.41.1653556 i | | | | | | | | | <  | 1 conclusion:
                                 | | | | | | | | |    | Succeeded.
   2018-05-30 16h09.41.1658407 i | | | | | | | | < 
   2018-05-30 16h09.41.1658407 i | | | | | | | < 
   2018-05-30 16h09.41.1726223 i | | | | | | | > Copying generated files to folder: 'C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461\'.
   2018-05-30 16h09.41.1726223 i | | | | | | | | CK.StObj.AutoAssembly.dll.0.cs
   2018-05-30 16h09.41.2165366 i | | | | | | | | CK.StObj.AutoAssembly.dll.1.cs
   2018-05-30 16h09.41.2200298 i | | | | | | | | CK.StObj.AutoAssembly.dll
   2018-05-30 16h09.41.2429875 i | | | | | | | < 
   2018-05-30 16h09.41.2429875 i | | | | | | | > Copying generated files to folder: 'C:\Dev\CK-AspNet-Projects\CK-AspNet-Auth\Tests\Integration\WebApp.Tests\bin\Debug\net461'.
   2018-05-30 16h09.41.2429875 i | | | | | | | | CK.StObj.AutoAssembly.dll.0.cs
   2018-05-30 16h09.41.2469823 i | | | | | | | | CK.StObj.AutoAssembly.dll.1.cs
   2018-05-30 16h09.41.2499739 i | | | | | | | | CK.StObj.AutoAssembly.dll
   2018-05-30 16h09.41.2524693 i | | | | | | | < 
   2018-05-30 16h09.41.2529691 i | | | | | | < 
   2018-05-30 16h09.41.2609534 i | | | | | | > Terminating Aspects.
   2018-05-30 16h09.41.2609534 i | | | | | | | > Aspect: CK.SqlServer.Setup.SqlSetupAspect.
   2018-05-30 16h09.41.2609534 i | | | | | | | < 
   2018-05-30 16h09.41.2614545 i | | | | | | | > Aspect: CK.Setup.SetupableAspect.
   2018-05-30 16h09.41.2715750 i | | | | | | | < 
   2018-05-30 16h09.41.2715750 i | | | | | | | > Executing initial 0 deferred actions.
   2018-05-30 16h09.41.2715750 i | | | | | | | <  | 1 conclusion:
                                 | | | | | | |    | Executed 0 actions.
   2018-05-30 16h09.41.2715750 i | | | | | | < 
   2018-05-30 16h09.41.2740677 W | | | | | | > 2 assembly load conflicts:
   2018-05-30 16h09.41.2740677 W | | | | | | | Sucess: 'System.Collections.Immutable, Version=1.2.2.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' => 'System.Collections.Immutable, Version=1.2.1.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' (no requesting assembly)
   2018-05-30 16h09.41.2740677 W | | | | | | | Sucess: 'System.Collections.Immutable, Version=1.2.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' => 'System.Collections.Immutable, Version=1.2.1.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' (no requesting assembly)
   2018-05-30 16h09.41.2745644 W | | | | | | < 
   2018-05-30 16h09.41.6698346 i | | | | | < 
   2018-05-30 16h09.41.6698346   | | | | < 
   2018-05-30 16h09.41.6713309 i | | | < 
   2018-05-30 16h09.41.6723287   | | | > Updating signature files.
   2018-05-30 16h09.41.6753230   | | | < 
   2018-05-30 16h09.41.6768215 i | | | > Deleting temporary Working Directory.
   2018-05-30 16h09.41.7706686 i | | | < 
   2018-05-30 16h09.41.7706686 i | | <  | 1 conclusion:
                                 | |    | Succeed
   2018-05-30 16h09.41.7716673 i | | > Closing Store.
   2018-05-30 16h09.41.7726651 i | | < 
   2018-05-30 16h09.41.7726651 i | | > Closing Store.
   2018-05-30 16h09.41.7726651 i | | < 
   2018-05-30 16h09.41.7726651 i | < 
   2018-05-30 16h09.41.7726651 i < 
